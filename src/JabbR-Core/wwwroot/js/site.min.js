function colorHslToRgb(n){var f,e,o,r,i,t;if(r=n.h,i=n.s,t=n.l,i===0)f=e=o=t;else{var s=function(n,t,i){return i<1/6?n:i<1/2?t:(i<2/3,n)},u=t<.5?t*(1+i):t+i-t*i,h=2*t-u;f=s(h,u,r+1/3);e=s(h,u,r);o=s(h,u,r-1/3)}n.r=parseInt(f*255,10);n.g=parseInt(e*255,10);n.b=parseInt(o*255,10)}function colorRgbToHsl(n){var r,t,i,e;r=n.r;t=n.g;i=n.b;r/=255;t/=255;i/=255;var u=Math.max(r,t,i),o=Math.min(r,t,i),f,s,h=(u+o)/2;if(u==o)f=s=0;else{e=u-o;s=h>.5?e/(2-u-o):e/(u+o);switch(u){case r:f=(t-i)/e+(t<i?6:0);break;case t:f=(i-r)/e+2;break;case i:f=(r-t)/e+4}f/=6}n.h=f;n.s=s;n.l=h}function main(){var r,u,v,n,o,s,h,c,i,f,e,t,l,a;for(n=document.getElementById("canvas"),o=n.getContext("2d"),u=n.width,v=n.height,s=u/2,h=u/2,c=5,f=1,e=10,a=4,t={r:0,g:16,b:63},r=[],i=0;i<a;i++)l={r:t.r,g:t.g,b:t.b},r.push({width:c,color:l,radius:f,x:s,y:h,offset:1,frameStart:e*i}),f-=.1,luminateColor(t);run(r,o,n,0,e)}function luminateColor(n){colorRgbToHsl(n);n.l+=.15;colorHslToRgb(n)}function clear(n,t){n.clearRect(0,0,t.width,t.height)}function run(n,t,i,r,u){var e,s,h,o,f;if(s=75,h=n.length*u+u,r===s+h)r=0;else for(e=0;e<n.length;e++)o=n[e],f||(f={r:o.color.r,g:o.color.g,b:o.color.b},colorRgbToHsl(f),f.h+=.001,f.h>=1&&(f.h=.001),colorHslToRgb(f)),o.color={r:f.r,g:f.g,b:f.b},luminateColor(f);for(clear(t,i),e=0;e<n.length;e++)o=n[e],setupArc(o,t,r,s);requestAnimFrame(function(){r++;run(n,t,i,r,u)})}function getPos(n,t,i,r){var f,u;return i<t.frameStart?i=0:(i-=t.frameStart,i>r&&(i=0)),f=i/r*Math.PI*2,u=n+f,u>Math.PI*2&&(u-=Math.PI*2),u}function setupArc(n,t,i,r){var u,f,e,o,s,h,c;u=n.width;s=n.color;f=n.x;e=n.y;o=(f-u)*n.radius;h=getPos(n.offset*Math.PI,n,i,r);c=getPos(n.offset*Math.PI*2,n,i,r);drawArc(t,u,f,e,o,h,c,s)}function drawArc(n,t,i,r,u,f,e,o){n.closePath();n.beginPath();n.lineWidth=t;n.strokeStyle="rgb("+o.r+","+o.g+","+o.b+")";n.arc(i,r,u,f,e,!1);n.stroke()}(function(n,t,i,r,u){"use strict";function g(){for(var n in c)c.hasOwnProperty(n)&&(clearTimeout(c[n]),r.failMessage(n),delete c[n])}function e(n){return f.state.name===n.Name}function vt(n){return n.IsAfk===!0?"afk":n.Note?"message":""}function yt(n){return n.IsAfk===!0?n.AfkNote?"AFK - "+n.AfkNote:"AFK":n.Note}function pt(n){return n.Flag?"flag flag-"+n.Flag:""}function p(){var t=n.Deferred();return n.post("account/logout",{}).done(function(){t.resolveWith(null);document.location=document.location.pathname}),t.promise()}function wt(){p().done(function(){f.server.send("/logout",f.state.activeRoom).fail(function(n){n.source==="HubException"&&r.addErrorToActiveRoom(n.message)})})}function bt(n){t.hub.log("loadRooms("+n.join(", ")+")");f.server.loadRooms(n).done(function(){t.hub.log("loadRooms.done("+n.join(", ")+")")}).fail(function(i){t.hub.log("loadRooms.failed("+n.join(", ")+", "+i+")")}).always(function(){r.hideSplashScreen()})}function nt(i,r){var u=r||n.Deferred();return t.hub.log("getRoomInfo("+i+")"),f.server.getRoomInfo(i).done(function(n){t.hub.log("getRoomInfo.done("+i+")");et(n);u.resolveWith(f)}).fail(function(n){t.hub.log("getRoomInfo.failed("+i+", "+n+")");ft++;ft<kt?setTimeout(function(){nt(i,u)},1e3):u.rejectWith(f)}),u.promise()}function et(t){var i=t.Name,u;n.each(t.Users,function(){var n=h(this);r.addUser(n,i);r.setUserActivity(n)});n.each(t.Owners,function(){r.setRoomOwner(this,i)});u=[];n.each(t.RecentMessages,function(){var n=k(this);u.push(n.id);r.addChatMessage(n,i)});r.changeRoomTopic(t.Name,t.Topic);r.setInitialized(i);r.scrollToBottom(i);r.setRoomListStatuses(i);r.watchMessageScroll(u,i)}function ot(){var i=n.Deferred();try{f.server.getRooms().done(function(n){r.populateLobbyRooms(n,rt);r.setInitialized("Lobby");i.resolveWith(f)})}catch(u){t.hub.log("getRooms failed");i.rejectWith(f)}return i.promise()}function tt(n,t){var i=r.isNearTheEnd(t);n();i&&r.scrollToBottom(t)}function h(t,i){var r=t.lastActivity.fromJsonDate();return{name:t.Name,hash:t.Hash,owner:i,active:t.Active,noteClass:vt(t),note:yt(t),flagClass:pt(t),flag:t.Flag,country:t.Country,lastActive:r,timeAgo:n.timeago(r),admin:t.IsAdmin,afk:t.IsAfk}}function k(n){var t=new RegExp("\\b@?"+f.state.name.replace(/\./g,"\\.")+"\\b","i");return{name:n.User.Name,hash:n.User.Hash,message:n.HtmlEncoded?n.Content:r.processContent(n.Content),htmlContent:n.HtmlContent,id:n.Id,date:n.When.fromJsonDate(),highlight:t.test(n.Content)?"highlight":"",isOwn:t.test(n.User.name),isMine:n.User.Name===f.state.name,imageUrl:n.ImageUrl,source:n.Source,messageType:n.MessageType,presence:(n.UserRoomPresence||"absent").toLowerCase(),status:dt(n.User).toLowerCase()}}function dt(n){return n.Status==="Active"&&n.IsAfk===!0?"Inactive":n.Status||"Offline"}function st(){var t={activeRoom:f.state.activeRoom,preferences:r.getState()},u=i.JSON.stringify(t);n.cookie("jabbr.state",u,{path:"/",expires:30})}function ht(){setTimeout(function(){document.title=v===0?it:(y?"*":"")+"("+v+") "+it},200)}function ct(){y=!1;v=0;d(f.state.activeRoom,!1)}function d(n,t){r.hasFocus()===!1?(y=y||t,v=v+1):y=!1;r.updateUnread(n,t);ht()}var f=t.chat,l=[],s=0,it=document.title,v=0,y=!1,w=!1,lt=!1,b=!1,o=n(r),at=1500,c={},rt=null,a=0,ut=!1,kt=5,ft=0;f.client.joinRoom=function(n){r.setRoomLoading(!0,n.Name);var t=r.addRoom(n);r.setActiveRoom(n.Name);n.Private&&r.setRoomLocked(n.Name);n.Closed&&r.setRoomClosed(n.Name);t?nt(n.Name).done(function(){r.setRoomLoading(!1);r.addNotification(u.getLanguageResource("Chat_YouEnteredRoom",n.Name),n.Name);n.Welcome&&r.addWelcome(n.Welcome,n.Name)}):r.setRoomLoading(!1)};f.client.logOn=function(t,i,u){rt=i;var e=function(){var i=[];n.each(t,function(n,t){f.state.activeRoom!==t.Name&&i.push(t.Name)});a=i.length;bt(i)},o=function(){f.server.getCommands().done(function(n){r.setCommands(n)});f.server.getShortcuts().done(function(n){r.setShortcuts(n)})};n.each(t,function(n,t){r.addRoom(t);t.Private&&r.setRoomLocked(t.Name);t.Closed&&r.setRoomClosed(t.Name)});f.state.tabOrder=u.TabOrder;r.updateTabOrder(f.state.tabOrder);r.setUserName(f.state.name);r.setUserHash(f.state.hash);r.setUnreadNotifications(f.state.unreadNotifications);r.run();r.setActiveRoom(this.state.activeRoom||"Lobby");this.state.activeRoom?nt(this.state.activeRoom).done(function(){o();ot();e();a===0&&r.hideSplashScreen()}).fail(function(){e();console.log("logOn.populateRoom("+this.state.activeRoom+") failed");r.addMessage("Failed to populate '"+this.state.activeRoom+"'","error",this.state.activeRoom)}):ot().done(function(){o();e();a===0&&r.hideSplashScreen()})};f.client.roomLoaded=function(n){et(n);a===1?r.hideSplashScreen():a=a-1};f.client.logOut=function(){p()};f.client.lockRoom=function(n,t,i){e(n)||this.state.activeRoom!==t||r.addNotificationToActiveRoom(u.getLanguageResource("Chat_UserLockedRoom",n.Name,t));i?(r.setRoomLocked(t),r.updatePrivateLobbyRooms(t)):r.removeLobbyRoom(t)};f.client.roomLocked=function(n){r.addNotificationToActiveRoom(u.getLanguageResource("Chat_RoomNowLocked",n))};f.client.roomClosed=function(n){r.addNotificationToActiveRoom(u.getLanguageResource("Chat_RoomNowClosed",n));r.closeRoom(n);this.state.activeRoom===n&&r.toggleMessageSection(!0)};f.client.roomUnClosed=function(n){r.addNotificationToActiveRoom(u.getLanguageResource("Chat_RoomNowOpen",n));r.unCloseRoom(n);this.state.activeRoom===n&&r.toggleMessageSection(!1)};f.client.addOwner=function(n,t){r.setRoomOwner(n.Name,t)};f.client.removeOwner=function(n,t){r.clearRoomOwner(n.Name,t)};f.client.updateRoom=function(n){r.updateLobbyRoom(n)};f.client.markInactive=function(t){n.each(t,function(){var n=h(this);r.setUserActivity(n)})};f.client.updateActivity=function(n){var t=h(n);r.setUserActivity(t)};f.client.addMessageContent=function(n,t,i){tt(function(){r.addChatMessageContent(n,t,i)},i);d(i,!1);r.watchMessageScroll([n],i)};f.client.replaceMessage=function(n,t,i){var u,f;r.confirmMessage(n);u=k(t);tt(function(){r.overwriteMessage(n,u)},i);f=u.highlight==="highlight";d(i,f)};f.client.addMessage=function(n,t){var i=k(n),u;tt(function(){r.messageExists(i.id)?r.replaceMessage(i):r.addChatMessage(i,t)},t);u=i.highlight==="highlight";d(t,u)};f.client.addUser=function(n,t,i){var f=h(n,i),o=r.addUser(f,t);o&&(e(n)||r.addNotification(u.getLanguageResource("Chat_UserEnteredRoom",n.Name,t),t))};f.client.changeUserName=function(n,t,i){r.changeUserName(n,t,i);e(t)||r.addNotification(u.getLanguageResource("Chat_UserNameChanged",n,t.Name),i)};f.client.changeGravatar=function(n,t){r.changeGravatar(n,t);e(n)||r.addNotification(u.getLanguageResource("Chat_UserGravatarChanged",n.Name),t)};f.client.allowUser=function(n,t){r.addNotificationToActiveRoom(u.getLanguageResource("Chat_YouGrantedRoomAccess",n));r.updateLobbyRoom(t)};f.client.userAllowed=function(n,t){r.addNotificationToActiveRoom(u.getLanguageResource("Chat_UserGrantedRoomAccess",n,t))};f.client.unallowUser=function(n){r.addNotificationToActiveRoom(u.getLanguageResource("Chat_YourRoomAccessRevoked",n));r.removeLobbyRoom(n)};f.client.userUnallowed=function(n,t){r.addNotificationToActiveRoom(u.getLanguageResource("Chat_YouRevokedUserRoomAccess",n,t))};f.client.ownerMade=function(n,t){r.addNotificationToActiveRoom(u.getLanguageResource("Chat_UserGrantedRoomOwnership",n,t))};f.client.ownerRemoved=function(n,t){r.addNotificationToActiveRoom(u.getLanguageResource("Chat_UserRoomOwnershipRevoked",n,t))};f.client.makeOwner=function(n){r.addNotificationToActiveRoom(u.getLanguageResource("Chat_YouGrantedRoomOwnership",n))};f.client.demoteOwner=function(n){r.addNotificationToActiveRoom(u.getLanguageResource("Chat_YourRoomOwnershipRevoked",n))};f.client.gravatarChanged=function(n){r.setUserHash(n);r.addNotificationToActiveRoom(u.getLanguageResource("Chat_YourGravatarChanged"))};f.client.postNotification=function(n,t){r.addNotification(n,t)};f.client.postMessage=function(n,t,i){r.addMessage(n,t,i)};f.client.forceUpdate=function(){r.showUpdateUI()};f.client.ban=function(n,t,i,f){var o,s;if(e(n)){if(ut===!0)return;ut=!0;s=u.getLanguageResource("Chat_YouBannedTitle");o=f!==null?u.getLanguageResource("Chat_YouBannedReason",i.Name,f):u.getLanguageResource("Chat_YouBanned",i.Name);r.addModalMessage(s,o,"icon-ban-circle").done(function(){p()})}else o=f!==null?u.getLanguageResource("Chat_UserBannedReason",n.Name,i.Name,f):u.getLanguageResource("Chat_UserBanned",n.Name,i.Name),r.addNotification(o,t),r.removeUser(n,t)};f.client.unbanUser=function(n){var t="User "+n.Name+" was unbanned";r.addNotificationToActiveRoom(t)};f.client.checkBanned=function(n){var t="User "+n.Name+" is "+(n.IsBanned?"":"not ")+"banned ";r.addNotificationToActiveRoom(t)};f.client.showUserInfo=function(t){var o=t.LastActivity.fromJsonDate(),e,i=[],u="Currently "+t.Status;t.IsAfk&&(u+=t.Status==="Active"?" but ":" and ",u+=" is Afk");e="User information for "+t.Name+" ("+u+" - last seen "+n.timeago(o)+")";t.AfkNote?i.push("Afk: "+t.AfkNote):t.Note&&i.push("Note: "+t.Note);r.addListToActiveRoom(e,i);t.Hash&&n.getJSON("https://secure.gravatar.com/"+t.Hash+".json?callback=?").done(function(n){n&&n.entry&&r.showGravatarProfile(n.entry[0])});f.client.showUsersOwnedRoomList(t.Name,t.OwnedRooms)};f.client.changeAfk=function(n,t){var f=h(n),i;r.changeNote(f,t);i=e(n)?n.AfkNote?u.getLanguageResource("Chat_YouAreAfkNote",n.AfkNote):u.getLanguageResource("Chat_YouAreAfk"):n.AfkNote?u.getLanguageResource("Chat_UserIsAfkNote",n.Name,n.AfkNote):u.getLanguageResource("Chat_UserIsAfk",n.Name);r.addNotification(i,t)};f.client.changeNote=function(n,t){var f=h(n),i;r.changeNote(f,t);i=e(n)?n.Note?u.getLanguageResource("Chat_YourNoteSet",n.Note):u.getLanguageResource("Chat_YourNoteCleared"):n.Note?u.getLanguageResource("Chat_UserNoteSet",n.Name,n.Note):u.getLanguageResource("Chat_UserNoteCleared",n.Name);r.addNotification(i,t)};f.client.topicChanged=function(n,t,i){var f,e=t==="";f=i===r.getUserName()?e?u.getLanguageResource("Chat_YouClearedRoomTopic"):u.getLanguageResource("Chat_YouSetRoomTopic",t):e?u.getLanguageResource("Chat_UserClearedRoomTopic",i):u.getLanguageResource("Chat_UserSetRoomTopic",i,t);r.addNotification(f,n);r.changeRoomTopic(n,t)};f.client.welcomeChanged=function(n,t){var i;i=n?u.getLanguageResource("Chat_YouClearedRoomWelcome"):u.getLanguageResource("Chat_YouSetRoomWelcome",t);r.addNotificationToActiveRoom(i);t&&r.addWelcomeToActiveRoom(t)};f.client.flagChanged=function(n,t){var i;i=n?u.getLanguageResource("Chat_YouClearedFlag"):u.getLanguageResource("Chat_YouSetFlag",t);r.addNotificationToActiveRoom(i)};f.client.changeFlag=function(n,t){var i=h(n),f;r.changeFlag(i,t);e(n)||(f=n.Flag?u.getLanguageResource("Chat_UserSetFlag",n.Name,i.country):u.getLanguageResource("Chat_UserClearedFlag",n.Name),r.addNotification(f,t))};f.client.userNameChanged=function(n){f.state.name=n.Name;r.setUserName(f.state.name);r.addNotificationToActiveRoom(u.getLanguageResource("Chat_YourNameChanged",n.Name))};f.client.setTyping=function(n,t){var i=h(n);r.setUserTyping(i,t)};f.client.sendMeMessage=function(n,t,i){r.addAction(u.getLanguageResource("Chat_UserPerformsAction",n,t),i)};f.client.sendPrivateMessage=function(n,t,i){e({Name:t})&&(r.notify(!0),r.setLastPrivate(n));r.addPrivateMessage(u.getLanguageResource("Chat_PrivateMessage",n,t,i))};f.client.sendInvite=function(n,t,i){e({Name:t})?(r.notify(!0),r.addPrivateMessage(u.getLanguageResource("Chat_UserInvitedYouToRoom",n,i))):r.addPrivateMessage(u.getLanguageResource("Chat_YouInvitedUserToRoom",t,i))};f.client.nudge=function(t,f,o){function c(n){for(var r,i=function(n,t){parent.moveBy(n,t)},t=n;t>0;t--)for(r=1;r>0;r--)i(t,0),i(0,-t),i(-t,0),i(0,t),i(t,0),i(0,-t),i(-t,0),i(0,t),i(t,0),i(0,-t),i(-t,0),i(0,t)}var s,h;e({Name:t})||(n("#chat-area").pulse({opacity:0},{duration:300,pulses:3}),i.setTimeout(function(){c(20)},300));f?(e({Name:f})?(s=u.getLanguageResource("Chat_UserNudgedYou",t),h={message:s,name:t},r.nudge(h,t)):s=u.getLanguageResource("Chat_UserNudgedUser",t,f),r.addPrivateMessage(s)):r.addPrivateMessage(u.getLanguageResource("Chat_UserNudgedRoom",t,o))};f.client.leave=function(n,t){e(n)?(r.setRoomLoading(!1),f.state.activeRoom===t&&r.setActiveRoom("Lobby"),r.removeRoom(t)):(r.removeUser(n,t),r.addNotification(u.getLanguageResource("Chat_UserLeftRoom",n.Name,t),t))};f.client.kick=function(n,t,i,o){if(e(n)){var h=u.getLanguageResource("Chat_YouKickedTitle"),s;f.state.activeRoom===t&&r.setActiveRoom("Lobby");r.removeRoom(t);s=o!==null?u.getLanguageResource("Chat_YouKickedFromRoomReason",t,i.Name,o):u.getLanguageResource("Chat_YouKickedFromRoom",t,i.Name);r.addModalMessage(h,s,"icon-ban-circle")}else r.removeUser(n,t),o!==null?r.addNotification(u.getLanguageResource("Chat_UserKickedFromRoomReason",n.Name,t,i.Name,o),t):r.addNotification(u.getLanguageResource("Chat_UserKickedFromRoom",n.Name,t,i.Name),t)};f.client.showCommands=function(){r.showHelp()};f.client.showUsersInRoom=function(t,i){var f=u.getLanguageResource("Chat_RoomUsersHeader",t);i.length===0?r.addListToActiveRoom(f,[u.getLanguageResource("Chat_RoomUsersEmpty")]):r.addListToActiveRoom(f,n.map(i,function(n){return"- "+n}))};f.client.listUsers=function(n){n.length===0?r.addListToActiveRoom(u.getLanguageResource("Chat_RoomSearchEmpty"),[]):r.addListToActiveRoom(u.getLanguageResource("Chat_RoomSearchResults"),[n.join(", ")])};f.client.listAllowedUsers=function(n,t,i){t?i.length===0?r.addListToActiveRoom(u.getLanguageResource("Chat_RoomPrivateNoUsersAllowed",n),[]):r.addListToActiveRoom(u.getLanguageResource("Chat_RoomPrivateUsersAllowedResults",n),[i.join(", ")]):r.addListToActiveRoom(u.getLanguageResource("Chat_RoomNotPrivateAllowed",n),[])};f.client.listOwners=function(n,t,i){t.length===0?r.addListToActiveRoom(u.getLanguageResource("Chat_RoomOwnersEmpty",n),[]):(t=u.tagUsers(t,null,null,null,i),r.addListToActiveRoom(u.getLanguageResource("Chat_RoomOwnersResults",n),[t.join(", ")]))};f.client.showUsersRoomList=function(n,t){t.length===0?r.addListToActiveRoom(u.getLanguageResource("Chat_UserNotInRooms",n.Name,n.Status),[]):r.addListToActiveRoom(u.getLanguageResource("Chat_UserInRooms",n.Name,n.Status),[t.join(", ")])};f.client.showUsersOwnedRoomList=function(n,t){t.length===0?r.addListToActiveRoom(u.getLanguageResource("Chat_UserOwnsNoRooms",n),[]):r.addListToActiveRoom(u.getLanguageResource("Chat_UserOwnsRooms",n),[t.join(", ")])};f.client.addAdmin=function(n,t){r.setRoomAdmin(n.Name,t)};f.client.removeAdmin=function(n,t){r.clearRoomAdmin(n.Name,t)};f.client.adminMade=function(n){r.addNotificationToActiveRoom(u.getLanguageResource("Chat_UserAdminAllowed",n))};f.client.adminRemoved=function(n){r.addNotificationToActiveRoom(u.getLanguageResource("Chat_UserAdminRevoked",n))};f.client.makeAdmin=function(){r.addNotificationToActiveRoom(u.getLanguageResource("Chat_YouAdminAllowed"))};f.client.demoteAdmin=function(){r.addNotificationToActiveRoom(u.getLanguageResource("Chat_YouAdminRevoked"))};f.client.broadcastMessage=function(n,t){r.addBroadcast(u.getLanguageResource("Chat_AdminBroadcast",n),t)};f.client.outOfSync=function(){r.showUpdateUI()};f.client.updateUnreadNotifications=function(n){r.setUnreadNotifications(n)};f.client.updateTabOrder=function(n){r.updateTabOrder(n)};o.bind(r.events.typing,function(){if(f.state.activeRoom&&lt===!1&&b===!1){b=!0;try{r.setRoomTrimmable(f.state.activeRoom,b);f.server.typing(f.state.activeRoom)}catch(n){t.hub.log("Failed to send via websockets")}i.setTimeout(function(){b=!1},3e3)}});o.bind(r.events.fileUploaded,function(n,i){i.submitFile(t.hub.id,f.state.activeRoom)});o.bind(r.events.sendMessage,function(e,o,h,a){ct();var v=h||u.newId(),p={id:v,content:o,room:f.state.activeRoom},y=null;a||(y=i.setTimeout(function(){n.connection.hub.state===n.connection.connectionState.reconnecting?r.failMessage(v):r.markMessagePending(v)},at),c[v]=y);try{f.server.send(p).done(function(){y&&(clearTimeout(y),delete c[v]);r.confirmMessage(v)}).fail(function(n){a=o.match(/^\/[A-Za-z0-9?]+?/)!==null;r.failMessage(v,a);n.source==="HubException"&&r.addErrorToActiveRoom(n.message)})}catch(w){t.hub.log("Failed to send via websockets");clearTimeout(c[v]);r.failMessage(v)}l.push(o);s=l.length});o.bind(r.events.focusit,function(){ct();try{f.server.updateActivity()}catch(n){t.hub.log("updateActivity failed")}});o.bind(r.events.blurit,function(){ht()});o.bind(r.events.openRoom,function(n,i){try{f.server.send("/join "+i,f.state.activeRoom).fail(function(n){r.setActiveRoom("Lobby");n.source==="HubException"&&r.addErrorToActiveRoom(n.message)})}catch(u){t.hub.log("openRoom failed")}});o.bind(r.events.closeRoom,function(n,i){try{f.server.send("/leave "+i,f.state.activeRoom).fail(function(n){n.source==="HubException"&&r.addErrorToActiveRoom(n.message)})}catch(u){t.hub.log("closeRoom room failed")}});o.bind(r.events.prevMessage,function(){s-=1;s<0&&(s=l.length-1);r.setMessage(l[s])});o.bind(r.events.nextMessage,function(){s=(s+1)%l.length;r.setMessage(l[s])});o.bind(r.events.activeRoomChanged,function(n,t){f.state.activeRoom=t==="Lobby"?undefined:t;r.scrollToBottom(t);st()});o.bind(r.events.scrollRoomTop,function(u,e){if(w!==!0){w=!0;try{r.setLoadingHistory(!0);r.setRoomTrimmable(e.name,!1);t.hub.log("getPreviousMessages("+e.name+")");f.server.getPreviousMessages(e.messageId).done(function(u){t.hub.log("getPreviousMessages.done("+e.name+")");r.prependChatMessages(n.map(u,k),e.name);i.setTimeout(function(){w=!1},1e3);r.setLoadingHistory(!1)}).fail(function(n){t.hub.log("getPreviousMessages.failed("+e.name+", "+n+")");i.setTimeout(function(){w=!1},1e3);r.setLoadingHistory(!1)})}catch(o){t.hub.log("getPreviousMessages failed");r.setLoadingHistory(!1)}}});n(r).bind(r.events.reloadMessages,function(){});n(r).bind(r.events.preferencesChanged,function(){st()});n(r).bind(r.events.loggedOut,function(){wt()});o.bind(r.events.tabOrderChanged,function(n,t){var u=!1,i;if((f.tabOrder===undefined||f.tabOrder.length!==t.length)&&(u=!0),u===!1)for(i=0;i<t.length;i++)f.tabOrder[i]!==t[i]&&(u=!0);u!==!1&&f.server.tabOrderChanged(t).done(function(){f.tabOrder=t}).fail(function(){r.updateTabOrder(f.tabOrder)})});n(function(){function a(){var h=n.cookie("jabbr.logging")==="1",s=n.cookie("jabbr.transport")||["webSockets","serverSentEvents","longPolling"],u={};s&&(u.transport=s);t.hub.logging=h;t.hub.qs="version="+i.jabbrVersion;t.hub.start(u).done(function(){f.server.join().fail(function(){p()});o=!0});t.hub.stateChanged(function(t){t.newState===n.connection.connectionState.reconnecting?(g(),r.showStatus(1,"")):t.newState===n.connection.connectionState.connected?(e?r.initializeConnectionStatus(n.connection.hub.transport.name):(r.showStatus(0,n.connection.hub.transport.name),r.setReadOnly(!1)),e=!1):t.newState===n.connection.connectionState.disconnected&&e===!0&&(e=!1)});t.hub.disconnected(function(){o===!0&&(t.hub.log("Dropped the connection from the server. Restarting in 5 seconds."),g());r.showStatus(2,"");r.setReadOnly(!0);setTimeout(function(){t.hub.start(u).done(function(){f.server.join(o).fail(function(){p()});o=!0})},5e3)});t.hub.error(function(){g()})}var h=n.cookie("jabbr.state"),l=h?JSON.parse(h):{},e=!0,o=!1,c=u.getLanguageResource("Chat_InitialMessages").split("\n"),s;for(r.initialize(l.preferences),s=0;s<c.length;s++)r.addNotificationToActiveRoom(c[s]);a()})})(window.jQuery,window.jQuery.connection,window,window.chat.ui,window.chat.utility),function(n,t,i,r){"use strict";t.captureDocumentWrite=function(t,u,f){n.fn.captureDocumentWrite(t,function(t){var c=i.isNearTheEnd(),s=null,e=null,o=null,h=null;s=f.closest("ul.messages").attr("id");s=s.substring(9);e=n('<div><h3 class="collapsible_title">'+r.getLanguageResource("Content_HeaderAndToggle",u)+'<\/h3><div class="collapsible_box captureDocumentWrite_content"><\/div><\/div>');n(".captureDocumentWrite_content",e).append(t);h=n("link",e);h.remove();n("head").append(h);n("a",e).removeAttr("target").attr("target","_blank");o=e[0].outerHTML;i.shouldCollapseContent(o,s)&&(o=i.collapseRichContent(o));f.append(o);c&&i.scrollToBottom()})}}(window.jQuery,window,chat.ui,chat.utility);var Emoji={};(function(){"use strict";var n={"+1":!0,"-1":!0,"0":!0,"1":!0,"100":!0,"109":!0,"1234":!0,"2":!0,"3":!0,"4":!0,"5":!0,"6":!0,"7":!0,"8":!0,"8ball":!0,"9":!0,a:!0,ab:!0,abc:!0,abcd:!0,accept:!0,aerial_tramway:!0,airplane:!0,alarm_clock:!0,alien:!0,ambulance:!0,anchor:!0,angel:!0,anger:!0,angry:!0,anguished:!0,ant:!0,apple:!0,aquarius:!0,aries:!0,arrows_clockwise:!0,arrows_counterclockwise:!0,arrow_backward:!0,arrow_double_down:!0,arrow_double_up:!0,arrow_down:!0,arrow_down_small:!0,arrow_forward:!0,arrow_heading_down:!0,arrow_heading_up:!0,arrow_left:!0,arrow_lower_left:!0,arrow_lower_right:!0,arrow_right:!0,arrow_right_hook:!0,arrow_up:!0,arrow_upper_left:!0,arrow_upper_right:!0,arrow_up_down:!0,arrow_up_small:!0,art:!0,articulated_lorry:!0,astonished:!0,atm:!0,b:!0,baby:!0,baby_bottle:!0,baby_chick:!0,baby_symbol:!0,back:!0,baggage_claim:!0,balloon:!0,ballot_box_with_check:!0,bamboo:!0,banana:!0,bangbang:!0,bank:!0,barber:!0,bar_chart:!0,baseball:!0,basketball:!0,bath:!0,bathtub:!0,battery:!0,bear:!0,bee:!0,beer:!0,beers:!0,beetle:!0,beginner:!0,bell:!0,bento:!0,bicyclist:!0,bike:!0,bikini:!0,bird:!0,birthday:!0,black_circle:!0,black_joker:!0,black_medium_small_square:!0,black_medium_square:!0,black_nib:!0,black_small_square:!0,black_square:!0,black_square_button:!0,blossom:!0,blowfish:!0,blue_book:!0,blue_car:!0,blue_heart:!0,blush:!0,boar:!0,boat:!0,bomb:!0,book:!0,bookmark:!0,bookmark_tabs:!0,books:!0,boom:!0,boot:!0,bouquet:!0,bow:!0,bowling:!0,bowtie:!0,boy:!0,bread:!0,bride_with_veil:!0,bridge_at_night:!0,briefcase:!0,broken_heart:!0,bug:!0,bulb:!0,bullettrain_front:!0,bullettrain_side:!0,bus:!0,busstop:!0,busts_in_silhouette:!0,bust_in_silhouette:!0,cactus:!0,cake:!0,calendar:!0,calling:!0,camel:!0,camera:!0,cancer:!0,candy:!0,capital_abcd:!0,capricorn:!0,car:!0,card_index:!0,carousel_horse:!0,cat:!0,cat2:!0,cd:!0,chart:!0,chart_with_downwards_trend:!0,chart_with_upwards_trend:!0,checkered_flag:!0,cherries:!0,cherry_blossom:!0,chestnut:!0,chicken:!0,children_crossing:!0,chocolate_bar:!0,christmas_tree:!0,church:!0,cinema:!0,circus_tent:!0,city_sunrise:!0,city_sunset:!0,cl:!0,clap:!0,clapper:!0,clipboard:!0,clock1:!0,clock10:!0,clock1030:!0,clock11:!0,clock1130:!0,clock12:!0,clock1230:!0,clock130:!0,clock2:!0,clock230:!0,clock3:!0,clock330:!0,clock4:!0,clock430:!0,clock5:!0,clock530:!0,clock6:!0,clock630:!0,clock7:!0,clock730:!0,clock8:!0,clock830:!0,clock9:!0,clock930:!0,closed_book:!0,closed_lock_with_key:!0,closed_umbrella:!0,cloud:!0,clubs:!0,cn:!0,cocktail:!0,coffee:!0,cold_sweat:!0,collision:!0,computer:!0,confetti_ball:!0,confounded:!0,confused:!0,congratulations:!0,construction:!0,construction_worker:!0,convenience_store:!0,cookie:!0,cool:!0,cop:!0,copyright:!0,corn:!0,couple:!0,couplekiss:!0,couple_with_heart:!0,cow:!0,cow2:!0,credit_card:!0,crocodile:!0,crossed_flags:!0,crown:!0,cry:!0,crying_cat_face:!0,crystal_ball:!0,cupid:!0,curly_loop:!0,currency_exchange:!0,curry:!0,custard:!0,customs:!0,cyclone:!0,dancer:!0,dancers:!0,dango:!0,dart:!0,dash:!0,date:!0,de:!0,deciduous_tree:!0,department_store:!0,diamonds:!0,diamond_shape_with_a_dot_inside:!0,disappointed:!0,disappointed_relieved:!0,dizzy:!0,dizzy_face:!0,dog:!0,dog2:!0,dollar:!0,dolls:!0,dolphin:!0,donut:!0,door:!0,doughnut:!0,do_not_litter:!0,dragon:!0,dragon_face:!0,dress:!0,dromedary_camel:!0,droplet:!0,dvd:!0,"e-mail":!0,ear:!0,earth_africa:!0,earth_americas:!0,earth_asia:!0,ear_of_rice:!0,egg:!0,eggplant:!0,egplant:!0,eight:!0,eight_pointed_black_star:!0,eight_spoked_asterisk:!0,electric_plug:!0,elephant:!0,email:!0,end:!0,envelope:!0,es:!0,euro:!0,european_castle:!0,european_post_office:!0,evergreen_tree:!0,exclamation:!0,expressionless:!0,eyeglasses:!0,eyes:!0,facepunch:!0,factory:!0,fallen_leaf:!0,family:!0,fast_forward:!0,fax:!0,fearful:!0,feelsgood:!0,feet:!0,ferris_wheel:!0,file_folder:!0,finnadie:!0,fire:!0,fireworks:!0,fire_engine:!0,first_quarter_moon:!0,first_quarter_moon_with_face:!0,fish:!0,fishing_pole_and_fish:!0,fish_cake:!0,fist:!0,five:!0,flags:!0,flashlight:!0,floppy_disk:!0,flower_playing_cards:!0,flushed:!0,foggy:!0,football:!0,fork_and_knife:!0,fountain:!0,four:!0,four_leaf_clover:!0,fr:!0,free:!0,fried_shrimp:!0,fries:!0,frog:!0,frowning:!0,fu:!0,fuelpump:!0,full_moon:!0,full_moon_with_face:!0,game_die:!0,gb:!0,gem:!0,gemini:!0,ghost:!0,gift:!0,gift_heart:!0,girl:!0,globe_with_meridians:!0,goat:!0,goberserk:!0,godmode:!0,golf:!0,grapes:!0,green_apple:!0,green_book:!0,green_heart:!0,grey_exclamation:!0,grey_question:!0,grimacing:!0,grin:!0,grinning:!0,guardsman:!0,guitar:!0,gun:!0,haircut:!0,hamburger:!0,hammer:!0,hamster:!0,hand:!0,handbag:!0,hankey:!0,hash:!0,hatched_chick:!0,hatching_chick:!0,headphones:!0,heart:!0,heartbeat:!0,heartpulse:!0,hearts:!0,heart_decoration:!0,heart_eyes:!0,heart_eyes_cat:!0,hear_no_evil:!0,heavy_check_mark:!0,heavy_division_sign:!0,heavy_dollar_sign:!0,heavy_exclamation_mark:!0,heavy_minus_sign:!0,heavy_multiplication_x:!0,heavy_plus_sign:!0,helicopter:!0,herb:!0,hibiscus:!0,high_brightness:!0,high_heel:!0,hocho:!0,honeybee:!0,honey_pot:!0,horse:!0,horse_racing:!0,hospital:!0,hotel:!0,hotsprings:!0,hourglass:!0,hourglass_flowing_sand:!0,house:!0,house_with_garden:!0,hurtrealbad:!0,hushed:!0,icecream:!0,ice_cream:!0,id:!0,ideograph_advantage:!0,imp:!0,inbox_tray:!0,incoming_envelope:!0,information_desk_person:!0,information_source:!0,innocent:!0,interrobang:!0,iphone:!0,it:!0,izakaya_lantern:!0,jack_o_lantern:!0,japan:!0,japanese_castle:!0,japanese_goblin:!0,japanese_ogre:!0,jeans:!0,joy:!0,joy_cat:!0,jp:!0,key:!0,keycap_ten:!0,kimono:!0,kiss:!0,kissing:!0,kissing_cat:!0,kissing_closed_eyes:!0,kissing_face:!0,kissing_heart:!0,kissing_smiling_eyes:!0,koala:!0,koko:!0,kr:!0,large_blue_circle:!0,large_blue_diamond:!0,large_orange_diamond:!0,last_quarter_moon:!0,last_quarter_moon_with_face:!0,laughing:!0,leaves:!0,ledger:!0,leftwards_arrow_with_hook:!0,left_luggage:!0,left_right_arrow:!0,lemon:!0,leo:!0,leopard:!0,libra:!0,light_rail:!0,link:!0,lips:!0,lipstick:!0,lock:!0,lock_with_ink_pen:!0,lollipop:!0,loop:!0,loudspeaker:!0,love_hotel:!0,love_letter:!0,low_brightness:!0,m:!0,mag:!0,mag_right:!0,mahjong:!0,mailbox:!0,mailbox_closed:!0,mailbox_with_mail:!0,mailbox_with_no_mail:!0,man:!0,mans_shoe:!0,man_with_gua_pi_mao:!0,man_with_turban:!0,maple_leaf:!0,mask:!0,massage:!0,meat_on_bone:!0,mega:!0,melon:!0,memo:!0,mens:!0,metal:!0,metro:!0,microphone:!0,microscope:!0,milky_way:!0,minibus:!0,minidisc:!0,mobile_phone_off:!0,moneybag:!0,money_with_wings:!0,monkey:!0,monkey_face:!0,monorail:!0,moon:!0,mortar_board:!0,mountain_bicyclist:!0,mountain_cableway:!0,mountain_railway:!0,mount_fuji:!0,mouse:!0,mouse2:!0,movie_camera:!0,moyai:!0,muscle:!0,mushroom:!0,musical_keyboard:!0,musical_note:!0,musical_score:!0,mute:!0,nail_care:!0,name_badge:!0,neckbeard:!0,necktie:!0,negative_squared_cross_mark:!0,neutral_face:!0,"new":!0,newspaper:!0,new_moon:!0,new_moon_with_face:!0,ng:!0,nine:!0,"non-potable_water":!0,nose:!0,notebook:!0,notebook_with_decorative_cover:!0,notes:!0,no_bell:!0,no_bicycles:!0,no_entry:!0,no_entry_sign:!0,no_good:!0,no_mobile_phones:!0,no_mouth:!0,no_pedestrians:!0,no_smoking:!0,nut_and_bolt:!0,o:!0,o2:!0,ocean:!0,octocat:!0,octopus:!0,oden:!0,office:!0,ok:!0,ok_hand:!0,ok_woman:!0,older_man:!0,older_woman:!0,on:!0,oncoming_automobile:!0,oncoming_bus:!0,oncoming_police_car:!0,oncoming_taxi:!0,one:!0,open_file_folder:!0,open_hands:!0,open_mouth:!0,ophiuchus:!0,orange_book:!0,outbox_tray:!0,ox:!0,"package":!0,pager:!0,page_facing_up:!0,page_with_curl:!0,palm_tree:!0,panda_face:!0,paperclip:!0,parking:!0,partly_sunny:!0,part_alternation_mark:!0,passport_control:!0,paw_prints:!0,peach:!0,pear:!0,pencil:!0,pencil2:!0,penguin:!0,pensive:!0,performing_arts:!0,persevere:!0,person_frowning:!0,person_with_blond_hair:!0,person_with_pouting_face:!0,phone:!0,pig:!0,pig2:!0,pig_nose:!0,pill:!0,pineapple:!0,pisces:!0,pizza:!0,plus1:!0,point_down:!0,point_left:!0,point_right:!0,point_up:!0,point_up_2:!0,police_car:!0,poodle:!0,poop:!0,postal_horn:!0,postbox:!0,post_office:!0,potable_water:!0,pouch:!0,poultry_leg:!0,pound:!0,pouting_cat:!0,pray:!0,princess:!0,punch:!0,purple_heart:!0,purse:!0,pushpin:!0,put_litter_in_its_place:!0,question:!0,rabbit:!0,rabbit2:!0,racehorse:!0,radio:!0,radio_button:!0,rage:!0,rage1:!0,rage2:!0,rage3:!0,rage4:!0,railway_car:!0,rainbow:!0,raised_hand:!0,raised_hands:!0,raising_hand:!0,ram:!0,ramen:!0,rat:!0,recycle:!0,red_car:!0,red_circle:!0,registered:!0,relaxed:!0,relieved:!0,repeat:!0,repeat_one:!0,restroom:!0,revolving_hearts:!0,rewind:!0,ribbon:!0,rice:!0,rice_ball:!0,rice_cracker:!0,rice_scene:!0,ring:!0,rocket:!0,roller_coaster:!0,rooster:!0,rose:!0,rotating_light:!0,round_pushpin:!0,rowboat:!0,ru:!0,rugby_football:!0,runner:!0,running:!0,running_shirt_with_sash:!0,sa:!0,sagittarius:!0,sailboat:!0,sake:!0,sandal:!0,santa:!0,satellite:!0,satisfied:!0,saxophone:!0,school:!0,school_satchel:!0,scissors:!0,scorpius:!0,scream:!0,scream_cat:!0,scroll:!0,seat:!0,secret:!0,seedling:!0,see_no_evil:!0,seven:!0,shaved_ice:!0,sheep:!0,shell:!0,ship:!0,shipit:!0,shirt:!0,shit:!0,shoe:!0,shower:!0,signal_strength:!0,six:!0,six_pointed_star:!0,ski:!0,skull:!0,sleeping:!0,sleepy:!0,slot_machine:!0,small_blue_diamond:!0,small_orange_diamond:!0,small_red_triangle:!0,small_red_triangle_down:!0,smile:!0,smiley:!0,smiley_cat:!0,smile_cat:!0,smiling_imp:!0,smirk:!0,smirk_cat:!0,smoking:!0,snail:!0,snake:!0,snowboarder:!0,snowflake:!0,snowman:!0,sob:!0,soccer:!0,soon:!0,sos:!0,sound:!0,space_invader:!0,spades:!0,spaghetti:!0,sparkle:!0,sparkler:!0,sparkles:!0,sparkling_heart:!0,speaker:!0,speak_no_evil:!0,speech_balloon:!0,speedboat:!0,squirrel:!0,star:!0,star2:!0,stars:!0,station:!0,statue_of_liberty:!0,steam_locomotive:!0,stew:!0,straight_ruler:!0,strawberry:!0,stuck_out_tongue:!0,stuck_out_tongue_closed_eyes:!0,stuck_out_tongue_winking_eye:!0,sunflower:!0,sunglasses:!0,sunny:!0,sunrise:!0,sunrise_over_mountains:!0,sun_with_face:!0,surfer:!0,sushi:!0,suspect:!0,suspension_railway:!0,sweat:!0,sweat_drops:!0,sweat_smile:!0,sweet_potato:!0,swimmer:!0,symbols:!0,syringe:!0,tada:!0,tanabata_tree:!0,tangerine:!0,taurus:!0,taxi:!0,tea:!0,telephone:!0,telephone_receiver:!0,telescope:!0,tennis:!0,tent:!0,thought_balloon:!0,three:!0,thumbsdown:!0,thumbsup:!0,ticket:!0,tiger:!0,tiger2:!0,tired_face:!0,tm:!0,toilet:!0,tokyo_tower:!0,tomato:!0,tongue:!0,top:!0,tophat:!0,tractor:!0,traffic_light:!0,train:!0,train2:!0,tram:!0,triangular_flag_on_post:!0,triangular_ruler:!0,trident:!0,triumph:!0,trolleybus:!0,trollface:!0,trophy:!0,tropical_drink:!0,tropical_fish:!0,truck:!0,trumpet:!0,tshirt:!0,tulip:!0,turtle:!0,tv:!0,twisted_rightwards_arrows:!0,two:!0,two_hearts:!0,two_men_holding_hands:!0,two_women_holding_hands:!0,u5272:!0,u5408:!0,u55b6:!0,u6307:!0,u6708:!0,u6709:!0,u6e80:!0,u7121:!0,u7533:!0,u7981:!0,u7a7a:!0,uk:!0,umbrella:!0,unamused:!0,underage:!0,unlock:!0,up:!0,us:!0,v:!0,vertical_traffic_light:!0,vhs:!0,vibration_mode:!0,video_camera:!0,video_game:!0,violin:!0,virgo:!0,volcano:!0,vs:!0,walking:!0,waning_crescent_moon:!0,waning_gibbous_moon:!0,warning:!0,watch:!0,watermelon:!0,water_buffalo:!0,wave:!0,wavy_dash:!0,waxing_crescent_moon:!0,waxing_gibbous_moon:!0,wc:!0,weary:!0,wedding:!0,whale:!0,whale2:!0,wheelchair:!0,white_check_mark:!0,white_circle:!0,white_flower:!0,white_large_square:!0,white_medium_small_square:!0,white_medium_square:!0,white_small_square:!0,white_square:!0,white_square_button:!0,wind_chime:!0,wine_glass:!0,wink:!0,wink2:!0,wolf:!0,woman:!0,womans_clothes:!0,womans_hat:!0,womens:!0,worried:!0,wrench:!0,x:!0,yellow_heart:!0,yen:!0,yum:!0,zap:!0,zero:!0,zzz:!0},t={"\\:-?\\)":":smile:",":-?D\\b":":grin:",";-?\\)":":wink:","\\:-?\\(":":disappointed:","\\:'-?\\(":":cry:",":-?P\\b":":tongue:",":-?p\\b":":tongue:",":-?O\\b":":astonished:",":-?o\\b":":astonished:","<3":":heart:"};Emoji.getIcons=function(){var t=[];for(var i in n)n.hasOwnProperty(i)&&t.push(i+":");return t};Emoji.Parser=function(){function i(n){var i,r;for(i in t)t.hasOwnProperty(i)&&(r=new RegExp(i,"g"),n=n.replace(r,"​"+t[i]+"​"));return n}function r(n){return n.replace(/:([a-z0-9\+\-_]+):/g,u)}function u(t,i){if(n[i]){var r=i;return r==="+1"&&(r="plus1"),'<span class="emoji20 emoji20-'+r+'" alt="'+i+'" title="'+i+'" />'}return":"+i+":"}this.parse=function(n){return i(n)};this.transformToHtml=r}})(),function(n,t,i){"use strict";t.addGitHubIssue=function(t){if(t.data.user){var u=i.isNearTheEnd(),r=null;r=n("div.git-hub-issue-"+t.data.number).removeClass("git-hub-issue-"+t.data.number);t.data.body=chat.utility.markdownToHtml(t.data.body);n("#github-issues-template").tmpl(t.data).appendTo(r);n("a",r).removeAttr("target").attr("target","_blank");n(".js-relative-date").timeago();u&&i.scrollToBottom();r.append('<script src="https://api.github.com/users/'+t.data.user.login+'?callback=addGitHubIssuesUser"><\/script>');t.data.assignee&&r.append('<script src="https://api.github.com/users/'+t.data.assignee.login+'?callback=addGitHubIssuesUser"><\/script>')}};t.addGitHubIssueComment=function(t){var u=i.isNearTheEnd(),r=null;r=n("div.git-hub-issue-"+t.data.id).removeClass("git-hub-issue-"+t.data.id);t.data.body=chat.utility.markdownToHtml(t.data.body);n("#github-issues-comment-template").tmpl(t.data).appendTo(r);n("a",r).removeAttr("target").attr("target","_blank");n(".js-relative-date").timeago();u&&i.scrollToBottom()};t.addGitHubIssuesUser=function(t){var i=n("a.github-issue-user-"+t.data.login);i.attr("href",t.data.html_url)}}(window.jQuery,window,chat.ui),function(n,t,i){"use strict";function u(){return n.extend(r,{isAllowed:function(){return t.Notification.permission==="granted"},isNotConfigured:function(){return t.Notification.permission==="default"},isBlocked:function(){return t.Notification.permission==="denied"},createNotification:function(r,u){var e=i.trim(r.name,50),f;return u&&(e+=" ("+u+")"),f=new t.Notification(e,{lang:"",dir:"auto",body:n("<div/>").html(r.message).text(),icon:"Content/images/logo32.png"}),f.onshow=this.onToastShow,f.onclick=this.onToastClick,f},removeNotification:function(n){n.close()},requestPermission:function(n){t.Notification.requestPermission(n)}})}function f(){return n.extend(r,{isAllowed:function(){return t.webkitNotifications.checkPermission()===0},isNotConfigured:function(){return t.webkitNotifications.checkPermission()===1},isBlocked:function(){return t.webkitNotifications.checkPermission()===2},createNotification:function(r,u){var e=i.trim(r.name,21),f;return e.length<=19&&u&&(e+=" ("+i.trim(u,19-e.length)+")"),f=t.webkitNotifications.createNotification("Content/images/logo32.png",e,n("<div/>").html(r.message).text()),f.ondisplay=this.onToastShow,f.onclick=this.onToastClick,f.show(),f},removeNotification:function(n){n.cancel()},requestPermission:function(n){t.webkitNotifications.requestPermission(n)}})}var r={current:null,timeOut:1e4,isAllowed:function(){return!1},isNotConfigured:function(){return!1},isBlocked:function(){return!0},canToast:function(){return!this.isBlocked()},ensureToast:function(n){this.isNotConfigured()&&(n.canToast=!1)},onToastShow:function(){setTimeout(function(){r.hideToast()},r.timeOut)},onToastClick:function(){var i=r.current.roomName;r.hideToast();t.focus();n(r).trigger("toast.focus",[i])},toastMessage:function(n,t){this.isAllowed()&&(this.hideToast(),this.current=this.createNotification(n,t),this.current.roomName=t)},hideToast:function(){this.current&&(this.removeNotification(this.current),this.current=null)},enableToast:function(){var t=n.Deferred();return this.isNotConfigured()?this.requestPermission(function(){r.isAllowed()?t.resolve():t.reject()}):this.isAllowed()?t.resolve():t.reject(),t}};t.chat||(t.chat={});t.Notification&&typeof t.Notification.permission=="string"?r=u():t.webkitNotifications&&(r=f());t.chat.toast=r}(window.jQuery,window,window.chat.utility),function(n,t,i){"use strict";t.addTweet=function(t){var e=i.isNearTheEnd(),r=null,u="/status/",f=t.url.substring(t.url.indexOf(u)+u.length);r=n("div.tweet_"+f).removeClass("tweet_"+f);n("#tweet-template").tmpl(t).appendTo(r);e&&i.scrollToBottom()}}(window.jQuery,window,chat.ui),function(n,t,i){"use strict";function s(n,t,f){o=f;r.show();c.hide();n.dataURL.indexOf("data:image")===0?(u.find("h3").text(i.getLanguageResource("Client_Uploading",t)),r.attr("src",n.dataURL)):(u.find("h3").text(i.getLanguageResource("Client_Uploading",n.name)),t==="image"?r.attr("src",n.data.result):(r.hide(),c.show()));u.modal()}function h(u){var f={submitFile:function(t,i){w.val(t);y.val(i);n.ajax({url:n("#upload").attr("action"),type:"POST",xhr:function(){var t=n.ajaxSettings.xhr();return t.upload&&t.upload.addEventListener("progress",function(){}),t},data:{file:u.data,room:i,connectionId:t,filename:u.name,size:u.length,type:u.type}}).done(function(){r.attr("src","")});e.val("")}};t.addMessage(i.getLanguageResource("Client_Uploading",u.name),"broadcast");l.trigger(t.events.fileUploaded,[f])}function b(){var n=navigator.userAgent.toLowerCase(),t=/(chrome)[ \/]([\w.]+)/.exec(n)||/(webkit)[ \/]([\w.]+)/.exec(n)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(n)||/(msie) ([\w.]+)/.exec(n)||n.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(n)||[];return{browser:t[1]||"",version:t[2]||"0"}}function f(){u.modal("hide");p.focus()}var l=n(t),e=n("#hidden-file"),u=n("#jabbr-upload-preview"),r=n("#jabbr-upload-preview #image-upload-preview"),c=n("#jabbr-upload-preview #unknown-upload-preview"),a=n("#jabbr-upload-preview #upload-preview-upload"),v=n("#jabbr-upload-preview #upload-preview-cancel"),y=n("#file-room"),p=n("#new-message"),w=n("#file-connection-id"),o=null;(function(){function r(t){n.event.fix=function(n){return function(t){return t=n.apply(this,arguments),(t.type.indexOf("copy")===0||t.type.indexOf("paste")===0)&&(t.clipboardData=t.originalEvent.clipboardData),t}}(n.event.fix);var i={callback:n.noop,matchType:/image.*/},r=function(t,r){return typeof r=="function"&&(r={callback:r}),r=n.extend({},i,r),n(t).each(function(){var t=this;return n(this).bind("paste",function(n){var u=!1,i=n.clipboardData;return Array.prototype.forEach.call(i.types,function(n,f){var e,o;return u?!0:n.match(r.matchType)||i.items[f].type.match(r.matchType)?(e=i.items[f].getAsFile(),o=new FileReader,o.onload=function(n){return r.callback.call(t,{dataURL:n.target.result,event:n,file:e,name:e.name})},o.readAsDataURL(e),u=!0,!0):void 0})})})};r("html",t)}var t={},i=b();i.browser&&(t[i.browser]=!0,t.version=i.version);t.chrome?t.webkit=!0:t.webkit&&(t.safari=!0);n.extend({imagePaste:function(n){t.webkit&&r(n)}})})();e[0].style.left="-800px";n.imagePaste(function(n){s(n,"clipboard",function(){n.name="clipboard.png";n.data=r.attr("src");n.filename=null;n.type="image/png";n.length=0;h(n)})});n(document).on("keydown",function(t){n("#jabbr-upload-preview").is(":visible")&&(t.keyCode==27?f():t.keyCode==13&&(o(),f()))});a.on("click",function(){o();f()});n(document).on("dragenter dragover",".messages.current",function(){n("#drop-file-target").fadeIn(500)});n(".drop-file-text").on("dragexit dragleave",function(n){n.preventDefault();n.stopPropagation()});n("#drop-file-target").on("dragexit dragleave",function(t){t.preventDefault();t.stopPropagation();t.currentTarget.id!=="drop-file-text"&&n("#drop-file-target").fadeOut(500)});n("#drop-file-target").on("dragenter dragover",function(n){return n.preventDefault(),n.stopPropagation(),!1});n("#drop-file-target").on("click",function(){n("#drop-file-target").fadeOut(500)});n("#drop-file-target").on("drop",function(t){if(t=t||window.event,t.stopPropagation(),t.preventDefault(),t.originalEvent.dataTransfer&&t.originalEvent.dataTransfer.files.length){var i=t.originalEvent.dataTransfer.files[0],r=new FileReader;r.onload=function(){return function(n){s({dataURL:n.target.result,name:i.name},i.name,function(){i.data=n.target.result;h(i)})}}(i);r.readAsDataURL(i)}return n("#drop-file-target").fadeOut(500),!1});v.on("click",function(){f()});e.change(function(n){var t=n.target.files[0],i=new FileReader;i.onload=function(){return function(n){s({dataURL:n.target.result,name:t.name},t.name,function(){t.data=n.target.result;h(t)})}}(t);i.readAsDataURL(t)})}(window.jQuery,window.chat.ui,window.chat.utility),function(n,t,i,r,u,f,e){"use strict";function eu(n){n.length&&n[0]==="/"&&(n=n.substr(1));var t=n.split("/");return t[0]==="rooms"?t[1]:null}function ou(n){return t.escape(n.toString().toLowerCase()).replace(/[^A-Za-z0-9]/g,"_")}function st(n){return'[data-name="'+n+'"]'}function er(n){return"_room_"+n}function su(n,i){if(n){var r=s(i);r.isInitialized()||(rr=t.setTimeout(function(){ir.fadeIn("slow")},rf))}else rr&&clearTimeout(rr),ir.fadeOut()}function or(t,i,r){n.tmpl(i,t).appendTo(r)}function hu(n){return n.sort(function(n,t){return n.Closed&&!t.Closed?1:t.Closed&&!n.Closed?-1:n.Count>t.Count?-1:t.Count>n.Count?1:n.Name.toString().toUpperCase().localeCompare(t.Name.toString().toUpperCase())})}function s(t){var i=ou(t);return new ur(n("#tabs-"+i),n("#userlist-"+i),n("#userlist-"+i+"-owners"),n("#userlist-"+i+"-active"),n("#messages-"+i),n("#roomTopic-"+i))}function c(){var t=p.find("li.current");return t.data("name")==="Lobby"?new ur(t,n("#userlist-lobby"),n("#userlist-lobby-owners"),n("#userlist-lobby-active"),n(".messages.current"),n(".roomTopic.current")):new ur(t,n(".users.current"),n(".userlist.current .owners"),n(".userlist.current .active"),n(".messages.current"),n(".roomTopic.current"))}function ti(){return p.find("li.current").data("name")}function sr(){var t=[];return n("ul#tabs > li.room, ul#tabs-dropdown > li.room").each(function(){t[t.length]=s(n(this).data("name"))}),t}function yt(){return s("Lobby")}function uf(){return g}function ff(n){var e=yt(),i=n.Private===!0?e.owners:e.users,t=i.find('[data-room="'+n.Name+'"]'),r=t.find(".count"),s=t.find(".topic"),h=n.Name.toString().toUpperCase(),c=o.processContent(n.Topic),f;if(t.length===0){cu(n);return}n.Count===0?r.text(u.getLanguageResource("Client_OccupantsZero")):n.Count===1?r.text(u.getLanguageResource("Client_OccupantsOne")):r.text(u.getLanguageResource("Client_OccupantsMany",n.Count));n.Private===!0?t.addClass("locked"):t.removeClass("locked");n.Closed===!0?t.addClass("closed"):t.removeClass("closed");s.html(c);f=lu(i,h,n.Count,n.Closed);t.data("count",n.Count);f!==null?t.insertBefore(f):t.appendTo(i);t.css("-webkit-animation-play-state","running").css("animation-play-state","running")}function cu(n){var f=yt(),i=null,r=n.Name.toString().toUpperCase(),c=n.Count,l=n.Closed,v=n.Private,e=n.Private?f.owners:f.users,t=null,s,h;if(n.processedTopic=o.processContent(n.Topic),i=a.lobbyroom.tmpl(n),s=lu(e,r,c,l),s!==null?i.insertBefore(s):i.appendTo(e),au(i),f.setListState(e),it[r]=!0,g){for(h=g.length,t=0;t<g.length;t++)if(g[t].Name.toString().toUpperCase().localeCompare(r)>0){h=t;break}g.splice(h,0,n)}if(b)for(t=0;t<b.length;t++)if(b[t].Name.toString().toUpperCase().localeCompare(r)===0){b.splice(t,1);break}v&&(vt.show(),ot.find(".nav-header").html(u.getLanguageResource("Client_OtherRooms")))}function lu(t,i,r,u){var f=null;return t.find("li").each(function(){var t=n(this),o=t.data("count"),h=t.hasClass("closed"),s=t.data("name"),e;return s===undefined?!0:(e=s.toString().toUpperCase().localeCompare(i),e===0)?!0:!h&&u?!0:o>r?!0:o===r&&e<0?!0:(f=t,!1)}),f}function au(n){var t=dt.val().toUpperCase(),i=di.is(":checked");n.data("room").toString().toUpperCase().score(t)>0&&(i||!n.is(".closed"))?n.show():n.hide()}function ef(t){var r=t.Name,v=s(t.Name),i=null,c=null,f=null,e=null,h=null,y=u.getLanguageResource("Chat_UserOwnerHeader"),w=u.getLanguageResource("Chat_UserHeader"),b=p.last();return v.exists()?!1:(i=ou(r),c={id:i,name:r,closed:t.Closed},it[r.toString().toUpperCase()]||cu(t),a.tab.tmpl(c).data("name",r).appendTo(b),o.updateTabOverflow(),f=n("<ul/>").attr("id","messages-"+i).addClass("messages").appendTo(wt).hide(),n("<div/>").attr("id","roomTopic-"+i).addClass("roomTopic").appendTo(wt).hide(),h=n("<div/>").attr("id","userlist-"+i).addClass("users").appendTo(wt).hide(),a.userlist.tmpl({listname:y,id:"userlist-"+i+"-owners"}).addClass("owners").appendTo(h),a.userlist.tmpl({listname:w,id:"userlist-"+i+"-active"}).appendTo(h),e=function(){var u=null,t;n(this).data("full")!==!0&&n(this).scrollTop()<=bu&&!o.isNearTheEnd(i)&&(t=f.children(".message:first"),t.length>0&&(u=t.attr("id").substr(2),l.trigger(o.events.scrollRoomTop,[{name:r,messageId:u}])))},f.bind("scroll",e),f.data("scrollHandler",e),hr(),ku=!1,!0)}function of(n){var t=s(n),i=null;t.exists()&&(i=t.messages.data("scrollHandler"),t.messages.unbind("scrollHandler",i),t.tab.remove(),t.messages.remove(),t.users.remove(),t.roomTopic.remove(),hr(),o.updateTabOverflow())}function hr(){n.each(p.find("li.room > a"),function(t,i){t<10?n(i).attr("accesskey",((t+1)%10).toString()):n(i).attr("accesskey",null)})}function sf(n){var r=(i.location.hash||"#").substr(1),t=eu(r);t&&t===n?o.setActiveRoomCore(n):i.location.hash="#/rooms/"+n}function hi(n,t){var i=cr(n.message,t);n.when=n.date.formatTime(!0);n.fulldate=n.date.toLocaleString();i&&(n.message=lr(n.message))}function hf(n){return n.indexOf('class="collapsible_box')>-1}function cr(n,t){var i=hf(n),r=t?pt(t,"blockRichness"):ar("blockRichness");return i&&r}function lr(n){return n=n.replace(/class="collapsible_box/g,'style="display: none;" class="collapsible_box'),n.replace(/class="collapsible_title"/g,'class="collapsible_title" title="'+u.getLanguageResource("Content_DisabledMessage")+'"')}function vu(){u.isMobile||tt||(ti()==="Lobby"?dt.focus():h.focus());nt===!1&&(nt=!0,l.trigger(o.events.focusit))}function cf(){}function lf(n,t){var i=t?pt(t,"blockRichness"):k.blockRichness;i===!0?n.addClass("off"):n.removeClass("off")}function yu(n,t,i){var r=i?pt(i,t):k[t];r===!0?n.removeClass("off"):n.addClass("off")}function af(n){yu(vi,"hasSound",n);yu(bt,"canToast",n);lf(fi,n)}function ii(n,t,i){var r=k[er(n)];r||(r={},k[er(n)]=r);r[t]=i;l.trigger(o.events.preferencesChanged)}function pt(n,t){return(k[er(n)]||{})[t]}function ar(n){var t=c();return pt(t.getName(),n)}function ci(t,i){var u=n.map(sr(),function(n){return"_room_"+n.getName()});for(var r in k)if(u.indexOf(r)!==-1&&k[r][t]===i)return!0;return!1}function pu(){var t,i,r;if(!tt){if(t=n.trim(h.val()),i=c(),nt=!0,t)if(o.isCommand(t))o.confirmCommand(t)||l.trigger(o.events.sendMessage,[t,null,!0]);else{if(i.isLobby())return o.addErrorToActiveRoom(u.getLanguageResource("Chat_CannotSendLobby")),!1;r={name:o.getUserName(),hash:o.getUserHash(),message:o.processContent(t),id:u.newId(),date:new Date,highlight:"",isMine:!0};o.addChatMessage(r,i.getName());l.trigger(o.events.sendMessage,[t,r.id,!1])}h.val("");h.focus();i.scrollToBottom();i.removeSeparator()}}function vr(t,i){var u=i.find(".name"),f=t.note,e=null,r=!1;t.noteClass==="afk"?(f=t.note+" ("+t.timeAgo+")",r=o.setUserInActive(i)):r=t.active?o.setUserActive(i):o.setUserInActive(i);e=n("<div/>").html(f).text();u.removeAttr("title");t.note&&u.attr("title",e);r&&i.each(function(){var t=s(n(this).data("inroom"));t.updateUserStatus(n(this));t.sortLists(n(this))})}function wu(n,t){var i=t.find(".flag");i.removeAttr("class");i.addClass("flag");i.removeAttr("title");n.flagClass?(i.addClass(n.flagClass),i.show()):i.hide();n.country&&i.attr("title",n.country)}function vf(n,t){var f=s(n),e=t===""?u.getLanguageResource("Chat_DefaultTopic",n):o.processContent(t),i=f.roomTopic,r=c().getName()===n;r&&i.hide();i.html(e);r&&i.fadeIn(2e3)}function yr(n){return{html:!0,trigger:"hover",template:gt,content:function(){return n}}}function yf(n){return{html:!0,trigger:"hover",delay:{show:0,hide:500},template:iu,content:function(){var t=ru;return t.find(uu).text(u.getLanguageResource("Client_ConnectedStatus")),t.find(fu).text(u.getLanguageResource("Client_Transport",n)),t.html()}}}function pf(){var n=yt(),t=b.slice(et,et+tr);or(t,a.lobbyroom,n.users);et=et+tr;d.submit()}var wt=null,p=null,ut=null,h=null,li=null,bt=null,pr=null,ft=null,ai=null,wr=null,br=null,kr=null,dr=null,l=null,vi=null,a=null,nt=!0,tt=!1,y={Up:38,Down:40,Esc:27,Enter:13,Slash:47,Space:32,Tab:9,Question:191},bu=75,ht=t.chat.toast,k=null,gr=null,kt=null,ri=null,yi=0,ui=null,pi=null,wi=null,bi=null,nu=null,ki=n(t),w=n(i),d=null,ku=!1,dt=null,di=null,du=15e3,fi=null,gi=null,it={},nr=null,rt=null,v=null,tu=-1,gt=null,ei=null,iu=null,ru=null,ct=null,lt=null,gu=null,nf=null,uu=null,fu=null,oi=null,tf=12e4,at=null,b=null,g=null,tr=100,et=0,vt=null,ot=null,ir=null,rf=250,rr=null,ur=r.Room,ni=null,fr=null,si=null,o={events:{closeRoom:"jabbr.ui.closeRoom",prevMessage:"jabbr.ui.prevMessage",openRoom:"jabbr.ui.openRoom",nextMessage:"jabbr.ui.nextMessage",activeRoomChanged:"jabbr.ui.activeRoomChanged",scrollRoomTop:"jabbr.ui.scrollRoomTop",typing:"jabbr.ui.typing",sendMessage:"jabbr.ui.sendMessage",focusit:"jabbr.ui.focusit",blurit:"jabbr.ui.blurit",preferencesChanged:"jabbr.ui.preferencesChanged",loggedOut:"jabbr.ui.loggedOut",reloadMessages:"jabbr.ui.reloadMessages",fileUploaded:"jabbr.ui.fileUploaded",tabOrderChanged:"jabbr.ui.tabOrderChanged"},help:{shortcut:"shortcut",global:"global",room:"room",user:"user"},initialize:function(r){function rt(n){var t=h[0].value;return t.length===0||gr===t?(l.trigger(n),!0):!1}var e,g;l=n(this);k=r||{};wt=n("#chat-area");p=n("#tabs, #tabs-dropdown");ut=n("#send");h=n("#new-message");li=n("#room-actions");bt=n("#room-preferences .toast");vi=n("#room-preferences .sound");fi=n("#room-preferences .richness");ft=n("#room-preferences .download");ai=n("#download-dialog");wr=n("#download-dialog-button");br=n("#download-range");kr=n("#preferences .logout");dr=n("#preferences .help");pr=n("#disconnect-dialog");kt=n("#jabbr-help");ri=n("#jabbr-help .help-body");ui=n("#jabbr-help #shortcut");pi=n("#jabbr-help #global");wi=n("#jabbr-help #room");bi=n("#jabbr-help #user");nu=n("#jabbr-update");nt=!0;d=n("#room-filter-form");dt=n("#room-filter");di=n("#room-filter-closed");a={userlist:n("#new-userlist-template"),user:n("#new-user-template"),message:n("#new-message-template"),notification:n("#new-notification-template"),separator:n("#message-separator-template"),tab:n("#new-tab-template"),gravatarprofile:n("#gravatar-profile-template"),commandhelp:n("#command-help-template"),multiline:n("#multiline-content-template"),lobbyroom:n("#new-lobby-room-template"),otherlobbyroom:n("#new-other-lobby-room-template"),commandConfirm:n("#command-confirm-template"),modalMessage:n("#modal-message-template")};nr=n("#reloadMessageNotification");ct=n(".upload-button");lt=n("#hidden-file");gu=n("#file-room");nf=n("#file-connection-id");v=n("#connectionStatus");gt=n("#connection-state-changed-popover");ei="#popover-content-icon";iu=n("#connection-info-popover");ru=n("#connection-info-content");uu="#connection-status";fu="#connection-transport";oi=n("#loadingRoomHistory");at=n("#load-more-rooms-item");vt=n("#lobby-private");ot=n("#lobby-other");ir=n("#room-loading");fr=n("#splash-screen");ni=n("#notification-unread-count");si=n("#create-room");ht.canToast()?bt.show():(fi.css({left:"55px"}),ft.css({left:"90px"}),k.canToast=!1,bt.hide());w.on("click","h3.collapsible_title",function(){var t=o.isNearTheEnd();n(this).next().toggle(0,function(){t&&o.scrollToBottom()})});e=function(n){var t=s(n);t.exists()?(t.isInitialized()?o.setRoomLoading(!1):o.setRoomLoading(!0,n),o.setActiveRoom(n)):l.trigger(o.events.openRoom,[n])};w.on("click","li.room .room-row",function(){var t=n(this).parent().data("name");e(t)});dt.keypress(function(t){var r=t.keyCode||t.which,i=n(this).val();switch(r){case y.Enter:if(it[i.toUpperCase()]){e(i);return}}});w.on("click","#tabs li, #tabs-dropdown li",function(){var t=n(this).data("name");e(t)});w.on("mousedown","#tabs li.room, #tabs-dropdown li.room",function(t){t.which===2&&l.trigger(o.events.closeRoom,[n(this).data("name")])});w.on("click","#load-more-rooms-item",function(){var n=at.find("i"),t;n.addClass("icon-spin");n.show();t=at.find(".load-more-rooms a");t.html(" "+u.getLanguageResource("LoadingMessage"));pf();n.hide();n.removeClass("icon-spin");t.html(u.getLanguageResource("Client_LoadMore"));et<b.length?at.show():at.hide()});w.on("click","#tabs li .close, #tabs-dropdown li .close",function(t){var i=n(this).closest("li").data("name");return l.trigger(o.events.closeRoom,[i]),t.preventDefault(),!1});n("#tabs, #tabs-dropdown").dragsort({placeHolderTemplate:'<li class="room placeholder"><a><span class="content"><\/span><\/a><\/li>',dragBetween:!0,dragStart:function(){var t=n(this).closest("li").data("name"),i=n(this).find(".close");if(i.length>0&&i.is(":hover"))return l.trigger(o.events.closeRoom,[t]),!1;e(t)},dragEnd:function(){for(var i=[],r=n("#tabs li, #tabs-dropdown li"),t=0;t<r.length;t++)i[t]=n(r[t]).data("name");l.trigger(o.events.tabOrderChanged,[i]);o.updateTabOverflow()}});w.on("click",".notification a.info",function(){var t=n(this).closest(".notification");n(this).hasClass("collapse")?o.collapseNotifications(t):o.expandNotifications(t)});w.on("click","#reloadMessageNotification a",function(){l.trigger(o.events.reloadMessages)});w.on("keydown",function(n){if(n.keyCode===y.Tab&&!n.ctrlKey&&h.val()===""){var r=c(),t=r.tab.index(),i=p.children().length-1;t=n.shiftKey?t-1||i:t%i+1;o.setActiveRoom(p.children().eq(t).data("name"));tt||h.focus()}!h.is(":focus")&&n.shiftKey&&n.keyCode===y.Question&&(o.showHelp(),n.preventDefault())});kt.on("hide",function(){ri.scrollTop(0)});kt.on("show",function(){yi===0&&(yi=kt.height()-ri.position().top-10);ri.css("height",yi)});g=function(){if(tt)return!1;var t=h.val().trim();return(t.indexOf("/msg")===0&&(t=t.replace(/^\/msg \S+/,"")),h.focus(),t[0]==="/")?!1:(t="@"+n(this).text().trim()+" "+t,o.setMessage(t),!1)};w.on("click",".users li.user .name",g);w.on("click",".message .left .name",g);w.on("click",".resend",function(){var t=n(this).parents(".message"),i=t.attr("id").slice(2),r=o.processContent(t.find(".middle").text());t.removeClass("failed");l.trigger(o.events.sendMessage,[r,i,!1])});ut.click(function(n){return pu(),n.preventDefault(),!1});vi.click(function(){var t=c(),i;t.isLobby()||(n(this).toggleClass("off"),i=!n(this).hasClass("off"),ii(t.getName(),"hasSound",i))});fi.click(function(){var i=c(),r=i.messages.find("h3.collapsible_title"),t;i.isLobby()||(n(this).toggleClass("off"),t=!n(this).hasClass("off"),ii(i.getName(),"blockRichness",!t),r.each(function(){var i=n(this),r=i.next().is(":visible");t?i.attr("title",u.getLanguageResource("Content_DisabledMessage")):i.removeAttr("title");r^t&&i.trigger("click")}))});bt.click(function(){var t=n(this),r=!t.hasClass("off"),i=c();i.isLobby()||(r?(ii(i.getName(),"canToast",!1),t.toggleClass("off")):ht.enableToast().done(function(){ii(i.getName(),"canToast",!0);t.removeClass("off")}).fail(function(){ii(i.getName(),"canToast",!1);t.addClass("off")}))});n(ht).bind("toast.focus",function(n,i){t.focus();e(i)});ft.click(function(){var n=c(),t,i;if(n.isLobby()||n.isLocked()){t=u.getLanguageResource("Client_DownloadMessages");i=u.getLanguageResource("Client_DownloadMessagesNotOpen",n.getName());o.addModalMessage(t,i,"icon-cloud-download");return}ai.modal({backdrop:!0,keyboard:!0})});wr.click(function(){var u=c(),t=i.location.href,r=t.indexOf("#");t=r>0?t.substring(0,r):t;t=t.replace("default.aspx","");t+="api/v1/messages/"+encodeURI(u.getName())+"?download=true&range="+encodeURIComponent(br.val());n('<iframe style="display:none">').attr("src",t).appendTo(i.body);ai.modal("hide")});si.click(function(){var n=prompt(u.getLanguageResource("Create_CommandInfo"),""),t="/create "+n;if(n===null)return!1;n===""?alert(u.getLanguageResource("RoomNameCannotBeBlank")):/\s/.test(n)?alert(u.getLanguageResource("RoomNameCannotContainSpaces")):l.trigger(o.events.sendMessage,[t,null,!0])});kr.click(function(){l.trigger(o.events.loggedOut)});dr.click(function(){o.showHelp()});dt.bind("input",function(){d.submit()}).keyup(function(){d.submit()});di.click(function(){d.submit()});d.submit(function(){var i=c(),t=vt.add(ot);return t.find("li:not(.empty)").each(function(){au(n(this))}),t.find("ul").each(function(){i.setListState(n(this))}),!1});ki.blur(function(){nt=!1;l.trigger(o.events.blurit)});ki.focus(function(){var n=c();n.makeActive();o.updateTabOverflow();vu()});ki.resize(function(){var n=c();n.scrollToBottom();o.updateTabOverflow()});h.keydown(function(t){var i=t.keyCode||t.which;switch(i){case y.Up:rt(o.events.prevMessage)&&t.preventDefault();break;case y.Down:rt(o.events.nextMessage)&&t.preventDefault();break;case y.Esc:n(this).val("");break;case y.Enter:return pu(),t.preventDefault(),!1;case y.Space:n(this).val()==="/r"&&gi&&o.setMessage("/msg "+gi)}});h.autoTabComplete({prefixMatch:"[@#/:]",get:function(t){switch(t){case"@":var i=c();return i.users.find('li[data-name != "'+o.getUserName()+'"]').not(".room").map(function(){return n(this).data("name")?n(this).data("name")+" ":""}).sort(function(n,t){return n.toString().toUpperCase().localeCompare(t.toString().toUpperCase())});case"#":return uf().map(function(n){return n.Name+" "});case"/":return o.getCommands().map(function(n){return n.Name+" "});case":":return f.getIcons();default:return[]}}});h.keypress(function(n){var t=n.keyCode||n.which;if(h.val()[0]!=="/"&&t!==y.Slash)switch(t){case y.Up:case y.Down:case y.Esc:case y.Enter:break;default:l.trigger(o.events.typing)}});tt||h.focus();ht.ensureToast(k);cf();n.livestamp.interval(3e4);setInterval(function(){o.trimRoomMessageHistory()},tf)},run:function(){n.history.init(function(n){var t=eu(n);t&&o.setActiveRoomCore(t)===!1&&t!=="Lobby"&&l.trigger(o.events.openRoom,[t])})},setMessage:function(n){h.val(n);gr=n;n&&(h.selectionEnd=n.length)},addRoom:ef,removeRoom:of,setRoomOwner:function(n,t){var i=s(t),r=i.getUser(n);r.attr("data-owner",!0).data("owner",!0);i.updateUserStatus(r)},clearRoomOwner:function(n,t){var i=s(t),r=i.getUser(n);r.removeAttr("data-owner").data("owner",!1);i.updateUserStatus(r)},setActiveRoom:sf,setActiveRoomCore:function(n){var t=s(n),i;return(af(n),t.isActive())?(l.trigger(o.events.activeRoomChanged,[n]),!0):(i=c(),t.exists())?(i.exists()&&(i.makeInactive(),i.isLobby()&&(d.hide(),li.show(),si.hide())),t.makeActive(),o.updateTabOverflow(),t.isLobby()&&(li.hide(),si.show(),d.show(),t.messages.hide()),o.toggleDownloadButton(t.isLocked()),o.toggleMessageSection(t.isClosed()),l.trigger(o.events.activeRoomChanged,[n]),vu(),su(!1),!0):!1},setRoomLocked:function(n){var t=s(n);t.setLocked();o.toggleDownloadButton(!0)},setRoomClosed:function(n){var t=s(n);t.close()},updateLobbyRoom:ff,updatePrivateLobbyRooms:function(n){var t=yt(),i=t.users.find('li[data-name="'+n+'"]');i.addClass("locked").appendTo(t.owners)},updateUnread:function(n,t){var i=n?s(n):c();o.hasFocus()&&i.isActive()||(i.updateUnread(t),o.updateTabOverflow())},scrollToBottom:function(n){var t=n?s(n):c();t.isActive()&&t.scrollToBottom()},watchMessageScroll:function(t,i){t=n.map(t,function(n){return"#m-"+n});var e=n(t.join(",")),u=e.expandableContent(),r=s(i),o=r.messages.isNearTheEnd(),f=r.messages.scrollTop();o&&u.length>0&&u.load(function(t){r.messages.isNearTheEnd()||f!==r.messages.scrollTop()||(r.scrollToBottom(),f=r.messages.scrollTop());n(this).unbind(t)})},isNearTheEnd:function(n){var t=n?s(n):c();return t.isNearTheEnd()},setRoomLoading:su,populateLobbyRooms:function(t,i){var f=yt(),r,e,h,s;if(!f.isInitialized()){for(r=0;r<t.length;++r)t[r].processedTopic=o.processContent(t[r].Topic);for(r=0;r<i.length;++r)i[r].processedTopic=o.processContent(i[r].Topic);for(r=0;r<t.length;++r)it[t[r].Name.toString().toUpperCase()]=!0;for(r=0;r<i.length;++r)it[i[r].Name.toString().toUpperCase()]=!0;e=hu(i);b=hu(t).filter(function(n){return!e.some(function(t){return t.Name===n.Name})});g=t.sort(function(n,t){return n.Name.toString().toUpperCase().localeCompare(t.Name.toString().toUpperCase())});f.owners.empty();f.users.empty();h=n("<ul/>");e.length>0?(or(e,a.lobbyroom,h),h.children("li").appendTo(f.owners),vt.show(),ot.find(".nav-header").html(u.getLanguageResource("Client_OtherRooms"))):(vt.hide(),ot.find(".nav-header").html(u.getLanguageResource("Client_Rooms")));s=n("<ul/>");or(b.slice(0,tr),a.lobbyroom,s);et=s.children("li").length;s.children("li").appendTo(f.users);et<b.length&&at.show();ot.show()}f.isActive()&&d.show();d.submit()},removeLobbyRoom:function(n){var i=n.toString().toUpperCase(),t=null,r,f;for(it[i]&&delete it[i],t=0;t<g.length;t++)if(g[t].Name.toString().toUpperCase().localeCompare(i)===0){g.splice(t,1);break}for(t=0;t<b.length;t++)if(b[t].Name.toString().toUpperCase().localeCompare(i)===0){b.splice(t,1);break}r=yt();f=r.users.add(r.owners).find('[data-room="'+n+'"]');f.remove();r.owners.find("li:not(.empty)").length===0&&(vt.hide(),ot.find(".nav-header").html(u.getLanguageResource("Client_Rooms")))},addUser:function(n,t){var r=s(t),i=null,u=r.messages.find(".message-user"+st(n.name));return(r.users.find(".removing").remove(),i=r.getUser(n.name),i.length)?!1:(i=a.user.tmpl(n),i.data("inroom",t),i.data("owner",n.owner),i.data("admin",n.admin),u.removeClass("offline active inactive absent present").addClass("active present"),r.addUser(n,i),vr(n,i),wu(n,i),!0)},setUserActivity:function(t){var i=n(".users .user"+st(t.name)),r=i.find(".inactive-since");t.active===!0&&t.afk===!1?(i.hasClass("inactive")&&(i.removeClass("inactive"),r.livestamp("destroy")),n(".message-user"+st(t.name)).removeClass("offline inactive").addClass("active")):(i.hasClass("inactive")||(i.addClass("inactive"),n(".message-user"+st(t.name)).removeClass("offline active").addClass("inactive")),r.html()||r.livestamp(t.lastActive));vr(t,i)},setUserActive:function(t){var i=t.find(".inactive-since"),r=n(".message-user"+st(t.data("name")));return t.data("active")===!0?!1:(t.attr("data-active",!0),t.data("active",!0),t.removeClass("inactive"),i.livestamp("isLiveStamp")&&i.livestamp("destroy"),r.removeClass("offline active inactive").addClass("active"),!0)},setUserInActive:function(t){var r=n(".message-user"+st(t.data("name"))),i=t.find(".inactive-since");return t.data("active")===!1?!1:(t.attr("data-active",!1),t.data("active",!1),t.addClass("inactive"),i.html()||i.livestamp(new Date),r.removeClass("offline active inactive").addClass("inactive"),!0)},changeUserName:function(t,i,r){var u=s(r),f=u.getUserReferences(t),e=u.getUser(t);f.find(".name").fadeOut("normal",function(){n(this).html(i.Name);n(this).fadeIn("normal")});f.data("name",i.Name);f.attr("data-name",i.Name);u.sortLists(e)},changeGravatar:function(n,t){var r=s(t),i=r.getUserReferences(n.Name),u="https://secure.gravatar.com/avatar/"+n.Hash+"?s=16&d=mm",f="https://secure.gravatar.com/avatar/"+n.Hash+"?s=96&d=mm";i.find(".gravatar-wrapper .gravatar").attr("src",u);i.find(".gravatar-wrapper .jabbr-user-card .gravatar-large").attr("src",f)},showGravatarProfile:function(n){var t=c(),i=o.isNearTheEnd();this.appendMessage(a.gravatarprofile.tmpl(n),t);i&&o.scrollToBottom()},removeUser:function(t,i){var r=s(i),u=r.getUser(t.Name),f=r.messages.find(st(t.Name));u.addClass("removing").fadeOut("slow",function(){var t=u.data("owner")||!1;n(this).remove();t===!0?r.setListState(r.owners):r.setListState(r.activeUsers)});f.find(".user").removeClass("absent present").addClass("absent")},setUserTyping:function(n,i){var e=s(i),r=e.getUser(n.name),f=null,u;(r.length===0&&o.addUser(n,i),n.name!==o.getUserName())&&(r.addClass("typing"),u=r.data("typing"),u&&clearTimeout(u),f=t.setTimeout(function(){r.removeClass("typing")},3e3),r.data("typing",f))},setLoadingHistory:function(n){if(n){var t=c();oi.appendTo(t.messages);oi.fadeIn("slow")}else oi.hide()},setRoomTrimmable:function(n,t){var i=s(n);i.setTrimmable(t)},prependChatMessages:function(t,i){var v=s(i),e=v.messages,r=e.children().first(),u=null,f=null,h=(new Date).addDays(1),c,l;if(t.length===0){e.data("full",!0);return}r.is(".list-header.date-header")&&(c=new Date(r.text()).toDate(),l=t[t.length-1].date.toDate(),l.diffDays(c)||(r.remove(),r=e.children().first()));n.each(t,function(){hi(this,i);u&&(f=u.data("name"),h=new Date(u.data("timestamp")||new Date));this.date.toDate().diffDays(h.toDate())&&(o.addMessageBeforeTarget(this.date.toLocaleDateString(),"list-header",r).addClass("date-header").find(".right").remove(),f=null);this.showUser=!f||f!==this.name;r.before(a.message.tmpl(this));this.showUser===!1&&u.addClass("continue");u=n("#m-"+this.id)});r.is(".message")&&r.data("name")===u.data("name")&&(r.find(".left").children().not(".state").remove(),u.addClass("continue"));r[0].scrollIntoView()},addChatMessage:function(n,t){var i=s(t),r=i.messages.children().last(),f=null,h=(new Date).addDays(1),u=!0,y=n.highlight,c=n.messageType===1,l,v,e;i.isClosed()||(r.length>0&&(f=r.data("name"),h=new Date(r.data("timestamp")||new Date)),n.date.toDate().diffDays(h.toDate())&&(f=null),u=f!==n.name&&!c,n.showUser=u,hi(n,t),u===!1&&r.addClass("continue"),i.needsSeparator()&&(i.hasSeparator()&&i.removeSeparator(),i.addSeparator()),c===!0?(l={id:n.id,content:n.message,img:n.imageUrl,source:n.source,encoded:!0},o.addMessage(l,"postedNotification",t)):(u===!0&&(v=i.getUser(n.name),e=v.find(".flag"),n.flagClass=e.attr("class"),n.flagTitle=e.attr("title")),this.appendMessage(a.message.tmpl(n),i)),n.htmlContent&&o.addChatMessageContent(n.id,n.htmlContent,i.getName()),i.isInitialized()&&(y?(ci("hasSound",!0)===!0&&o.notify(!0),nt===!1&&ci("canToast",!0)===!0&&o.toast(n,!0,t)):nt===!1&&(o.notifyRoom(t),o.toastRoom(t,n))))},overwriteMessage:function(t,i){var r=n("#m-"+t);hi(i);r.find(".middle").html(i.message);r.find(".right .time").attr("title",i.fulldate).text(i.when);r.attr("id","m-"+i.id)},replaceMessage:function(t){hi(t);n("#m-"+t.id).find(".middle").html(t.message)},messageExists:function(t){return n("#m-"+t).length>0},addChatMessageContent:function(t,i,r){var u=n("#m-"+t),f=u.find(".middle"),e=u.find(".content");cr(i,r)&&(i=lr(i));f.length===0?e.append("<p>"+i+"<\/p>"):f.append(i)},prepareNotificationMessage:function(n,t){typeof n=="string"&&(n={content:n,encoded:!1});var i=new Date,r={message:n.encoded?n.content:o.processContent(n.content),type:t,date:i,when:i.formatTime(!0),fulldate:i.toLocaleString(),img:n.img,source:n.source,id:n.id};return a.notification.tmpl(r)},addMessageBeforeTarget:function(n,t,i){var r=o.prepareNotificationMessage(n,t);return i.before(r),r},addMessage:function(n,t,i){var r=i?s(i):c(),f=r.isNearTheEnd(),u=o.prepareNotificationMessage(n,t);return this.appendMessage(u,r),t==="notification"&&r.isLobby()===!1&&o.collapseNotifications(u),f&&o.scrollToBottom(i),u},appendMessage:function(t,i){var r=n(t).is(".message"),s;if(!n(t).is(".date-header")&&(r||i.hasMessages())){var u=i.messages.find("li[data-timestamp]").last(),h=new Date(u.data("timestamp")),f=new Date(n(t).data("timestamp"));(!u.length||f.toDate().diffDays(h.toDate()))&&(s=e(f),o.addMessage(s.format("dddd, MMMM Do YYYY"),"date-header list-header",i.getName()).find(".right").remove())}r&&i.updateMessages(!0);n(t).appendTo(i.messages)},addNotification:function(n,t){this.addMessage(n,"notification",t)},addNotificationToActiveRoom:function(n){this.addNotification(n,ti())},addError:function(n,t){this.addMessage(n,"error",t)},addErrorToActiveRoom:function(n){this.addError(n,ti())},addWelcome:function(n,t){this.addMessage(n,"welcome",t)},addWelcomeToActiveRoom:function(n){this.addWelcome(n,ti())},addList:function(t,i,r){this.addMessage(t,"list-header",r);var u=this;n.each(i,function(){u.addMessage(this,"list-item",r)})},addListToActiveRoom:function(n,t){this.addList(n,t,ti())},addBroadcast:function(n,t){this.addMessage(n,"broadcast",t)},addAction:function(n,t){this.addMessage(n,"action",t)},addPrivateMessage:function(n){var t=sr();for(var i in t)t[i].getName()!==undefined&&t[i].isClosed()===!1&&this.addMessage(n,"pm",t[i].getName())},addModalMessage:function(t,i,r){var u=n.Deferred(),f=a.modalMessage.tmpl({Title:t,Body:i,Icon:r}).appendTo("#dialog-container").modal().on("hidden.bs.modal",function(){f.remove();u.resolve()}).on("click","a.btn",function(){f.modal("hide")});return u.promise()},hasFocus:function(){return nt},setShortcuts:function(t){ui.empty();n.each(t,function(){ui.append(a.commandhelp.tmpl(this))})},getCommands:function(){return o.commands||[]},getCommand:function(n){return o.commandsLookup?o.commandsLookup[n]:null},setCommands:function(t){var i,r;for(o.commands=t.sort(function(n,t){return n.Name.toString().toUpperCase().localeCompare(t.Name.toString().toUpperCase())}),o.commandsLookup={},i=0;i<t.length;++i)r=t[i],o.commandsLookup[r.Name]=r;pi.empty();wi.empty();bi.empty();n.each(o.getCommands(),function(){switch(this.Group){case o.help.shortcut:ui.append(a.commandhelp.tmpl(this));break;case o.help.global:pi.append(a.commandhelp.tmpl(this));break;case o.help.room:wi.append(a.commandhelp.tmpl(this));break;case o.help.user:bi.append(a.commandhelp.tmpl(this))}})},isCommand:function(n){var t,i;return n[0]==="/"&&(t=n.substr(1).split(" "),t.length>0&&(i=o.getCommand(t[0].toLowerCase()),i))?i.Name:null},confirmCommand:function(t){var u=o.isCommand(t),i=o.getCommand(u),r;return i&&i.ConfirmMessage!==null?(r=a.commandConfirm.tmpl(i).appendTo("#dialog-container").modal().on("hidden.bs.modal",function(){r.remove()}).on("click","a.btn",function(){n(this).is(".btn-danger")&&l.trigger(o.events.sendMessage,[t,null,!0]);r.modal("hide")}),!0):!1},setInitialized:function(n){var t=n?s(n):c();t.setInitialized()},collapseNotifications:function(n){var t=n.prevUntil(":not(.notification)");t.length>3&&(t.hide().find(".info").text(""),n.find(".info").text(" "+u.getLanguageResource("Chat_ExpandHiddenMessages",t.length)).removeClass("collapse"))},expandNotifications:function(n){var i=n.prevUntil(":not(.notification)"),r=n.position().top;n.find(".info").text(" "+u.getLanguageResource("Chat_CollapseHiddenMessages")).addClass("collapse");i.show();var t=c(),f=n.position().top,e=t.messages.scrollTop();t.messages.scrollTop(e+f-r+n.height())},getState:function(){return k},notifyRoom:function(t){pt(t,"hasSound")===!0&&n("#notificationSound")[0].play()},toastRoom:function(n,t){pt(n,"canToast")===!0&&ht.toastMessage(t,n)},notify:function(t){(ar("hasSound")===!0||t)&&n("#notificationSound")[0].play()},toast:function(n,t,i){(ar("canToast")===!0||t)&&ht.toastMessage(n,i)},nudge:function(n){ci("hasSound",!0)===!0&&o.notify(!0);nt===!1&&ci("canToast",!0)===!0&&o.toast(n,!0)},setUserName:function(n){o.name=n},setUnreadNotifications:function(n){n>0?(ni.text(n),ni.show()):(ni.text(""),ni.hide())},getUserName:function(){return o.name},getUserHash:function(){return o.userHash},setUserHash:function(n){o.userHash=n},showDisconnectUI:function(){pr.modal()},showHelp:function(){kt.modal()},showUpdateUI:function(){nu.modal();t.setTimeout(function(){i.location=i.location.pathname},du)},showReloadMessageNotification:function(){nr.appendTo(wt);nr.show()},showStatus:function(n,t){if(tu!==n){rt&&clearTimeout(rt);tu=n;v.popover("destroy");switch(n){case 0:v.removeClass("reconnecting disconnected");v.popover(yr(u.getLanguageResource("Client_Connected")));gt.find(ei).addClass("icon-ok-sign");v.popover("show");rt=setTimeout(function(){v.popover("destroy");o.initializeConnectionStatus(t);rt=null},2e3);break;case 1:v.removeClass("disconnected").addClass("reconnecting");v.popover(yr(u.getLanguageResource("Client_Reconnecting")));gt.find(ei).addClass("icon-question-sign");v.popover("show");rt=setTimeout(function(){v.popover("hide");rt=null},5e3);break;case 2:v.removeClass("reconnecting").addClass("disconnected");v.popover(yr(u.getLanguageResource("Client_Disconnected")));gt.find(ei).addClass("icon-exclamation-sign");v.popover("show");rt=setTimeout(function(){v.popover("hide");rt=null},5e3)}}},setReadOnly:function(t){tt=t;tt===!0?(lt.attr("disabled","disabled"),ut.attr("disabled","disabled"),h.attr("disabled","disabled"),ct.attr("disabled","disabled"),n(".message.failed .resend").addClass("disabled")):(lt.removeAttr("disabled"),ut.removeAttr("disabled"),h.removeAttr("disabled"),ct.removeAttr("disabled"),n(".message.failed .resend").removeClass("disabled"))},initializeConnectionStatus:function(n){v.popover(yf(n))},changeNote:function(n,t){var i=s(t),r=i.getUser(n.name);vr(n,r)},changeFlag:function(n,t){var i=s(t),r=i.getUser(n.name);wu(n,r)},changeRoomTopic:function(n,t){vf(n,t)},confirmMessage:function(t){n("#m-"+t).removeClass("failed").removeClass("loading")},failMessage:function(t,i){var r=n("#m-"+t);r.removeClass("loading");r.hasClass("failed")===!1&&r.hasClass("failed-command")===!1&&(i?r.addClass("failed-command"):r.addClass("failed"))},markMessagePending:function(t){var i=n("#m-"+t);i.hasClass("failed")===!1&&i.hasClass("failed-command")===!1&&i.addClass("loading")},setRoomAdmin:function(n,t){var i=s(t),r=i.getUser(n);r.attr("data-admin",!0).data("admin",!0).find(".admin").text("("+u.getLanguageResource("Client_AdminTag")+")");i.updateUserStatus(r)},clearRoomAdmin:function(n,t){var i=s(t),r=i.getUser(n);r.removeAttr("data-admin").data("admin",!1).find(".admin").text("");i.updateUserStatus(r)},setLastPrivate:function(n){gi=n},shouldCollapseContent:cr,collapseRichContent:lr,toggleMessageSection:function(t){t?(h.attr("disabled","disabled"),ut.attr("disabled","disabled"),ct.attr("disabled","disabled"),lt.attr("disabled","disabled"),n(".message.failed .resend").addClass("disabled")):tt||(h.attr("disabled",""),h.removeAttr("disabled"),ut.attr("disabled",""),ut.removeAttr("disabled"),ct.attr("disabled",""),ct.removeAttr("disabled"),lt.attr("disabled",""),lt.removeAttr("disabled"),n(".message.failed .resend").removeClass("disabled"))},toggleDownloadButton:function(n){n?(ft.addClass("off"),ft.attr("title","download messages disabled for private rooms")):(ft.removeClass("off"),ft.attr("title","download messages"))},closeRoom:function(n){var t=s(n);t.close()},unCloseRoom:function(n){var t=s(n);t.unClose()},setRoomListStatuses:function(n){var t=n?s(n):c();t.setListState(t.owners)},processContent:function(n){return u.processContent(n,a,it)},trimRoomMessageHistory:function(n){for(var i=n?[s(n)]:sr(),t=0;t<i.length;t++)i[t].trimHistory()},updateTabOrder:function(t){n.each(t.reverse(),function(n,t){p.find('li[data-name="'+t+'"]').prependTo(p.first())});o.updateTabOverflow();hr()},updateTabOverflow:function(){var e=0,i=-1,t=null,u=p.first(),s=p.last(),f=null,o=n("#tabs-dropdown-rooms"),r;if(p.last().find("li:not(.placeholder)").each(function(){n(this).css("visibility","hidden").detach().appendTo(u)}),t=u.find("li:not(.placeholder)"),t.length>0&&t.width()>u.width()?i=0:t.each(function(t){if(i===-1){var r=n(this).offset().left;if(r<=e){i=t;return}e=r}}),i!==-1)for(o.fadeIn("slow"),f=t.slice(i),r=f.length-1;r>=0;r--)n(f[r]).prependTo(s);else o.fadeOut("slow").parent().removeClass("open");t.each(function(){n(this).css("visibility","visible")});return},showSplashScreen:function(){fr.fadeIn("slow")},hideSplashScreen:function(){fr.fadeOut("slow")}};t.chat||(t.chat={});t.chat.ui=o}(window.jQuery,window,window.document,window.chat,window.chat.utility,window.Emoji,window.moment),function(n,t,i){"use strict";function u(n){return'[data-name="'+n+'"]'}function r(t,i,r,u,f,e){this.tab=t;this.users=i;this.owners=r;this.activeUsers=u;this.messages=f;this.roomTopic=e;this.templates={separator:n("#message-separator-template")}}var f=200;r.prototype.isLocked=function(){return this.tab.hasClass("locked")};r.prototype.isLobby=function(){return this.tab.hasClass("lobby")};r.prototype.hasUnread=function(){return this.tab.hasClass("unread")};r.prototype.hasMessages=function(){return this.tab.data("messages")};r.prototype.updateMessages=function(n){this.tab.data("messages",n)};r.prototype.getUnread=function(){return this.tab.data("unread")||0};r.prototype.hasSeparator=function(){return this.messages.find(".message-separator").length>0};r.prototype.needsSeparator=function(){return this.isActive()?!1:this.isInitialized()&&this.getUnread()===5};r.prototype.addSeparator=function(){if(!this.isLobby()){var n=this.getUnread(),t=this.messages.find(".message").eq(-(n+1));t.after(this.templates.separator.tmpl()).data("unread",n);this.scrollToBottom()}};r.prototype.removeSeparator=function(){this.messages.find(".message-separator").fadeOut(2e3,function(){n(this).remove()})};r.prototype.updateUnread=function(n){var t=this.tab.addClass("unread"),u=t.find(".content"),i=(t.data("unread")||0)+1,r=t.data("hasMentions")||n;u.text((r?"*":"")+"("+i+") "+this.getName());t.data("unread",i);t.data("hasMentions",r)};r.prototype.scrollToBottom=function(){n.browser.webkit&&this.messages.scrollTop(this.messages.scrollTop()-1);this.messages.scrollTop(this.messages[0].scrollHeight)};r.prototype.isNearTheEnd=function(){return this.messages.isNearTheEnd()};r.prototype.getName=function(){return this.tab.data("name")};r.prototype.isActive=function(){return this.tab.hasClass("current")};r.prototype.exists=function(){return this.tab.length>0};r.prototype.isClosed=function(){return this.tab.attr("data-closed")==="true"};r.prototype.close=function(){this.tab.attr("data-closed",!0);this.tab.addClass("closed");this.tab.find(".readonly").removeClass("hide")};r.prototype.unClose=function(){this.tab.attr("data-closed",!1);this.tab.removeClass("closed");this.tab.find(".readonly").addClass("hide")};r.prototype.clear=function(){this.messages.empty();this.owners.empty();this.activeUsers.empty()};r.prototype.makeInactive=function(){this.tab.removeClass("current");this.messages.removeClass("current").hide();this.users.removeClass("current").hide();this.roomTopic.removeClass("current").hide()};r.prototype.makeActive=function(){var n=this.getUnread(),t=this.messages.find(".message-separator").data("unread")||0;this.tab.addClass("current").removeClass("unread").data("unread",0).data("hasMentions",!1);this.tab.is(".room")&&this.tab.find(".content").text(this.getName());this.messages.addClass("current").show();this.users.addClass("current").show();this.roomTopic.addClass("current").show();n<=t&&this.removeSeparator()};r.prototype.setInitialized=function(){this.tab.data("initialized",!0)};r.prototype.isInitialized=function(){return this.tab.data("initialized")===!0};r.prototype.getUser=function(n){return this.users.find(u(n))};r.prototype.getUserReferences=function(t){return n.merge(this.getUser(t),this.messages.find(u(t)))};r.prototype.setLocked=function(){this.tab.addClass("locked");this.tab.find(".lock").removeClass("hide")};r.prototype.setListState=function(t){var i=t.children("li.empty"),r=t.children("li:not(.empty)").filter(function(){return n(this).css("display")!=="none"});r.length>0?i.remove():i.length===0&&t.append(n('<li class="empty" />').text(t.data("emptyMessage")))};r.prototype.addUser=function(n,t){n.owner?this.addUserToList(t,this.owners):(this.changeInactive(t,n.active),this.addUserToList(t,this.activeUsers))};r.prototype.changeInactive=function(n,t){t?n.removeClass("inactive"):n.addClass("inactive")};r.prototype.addUserToList=function(n,t){var i=n.parent("ul");n.appendTo(t);this.setListState(t);i.length>0&&this.setListState(i);this.sortList(t,n)};r.prototype.appearsInList=function(n,t){return n.parent("ul").attr("id")===t.attr("id")};r.prototype.updateUserStatus=function(n){var i=n.data("owner")||!1,t;if(i===!0){this.appearsInList(n,this.owners)||this.addUserToList(n,this.owners);return}(t=n.data("active"),typeof t!="undefined")&&(this.appearsInList(n,this.activeUsers)||(this.changeInactive(n,t),this.addUserToList(n,this.activeUsers)))};r.prototype.sortLists=function(t){var i=n(t).data("owner");i?this.sortList(this.owners,t):this.sortList(this.activeUsers,t)};r.prototype.sortList=function(t,i){for(var o,f,u=t.children("li:not(.empty)").get(),s=(n(i).data("name")||"").toString(),e=n(i).data("active"),r=0;r<u.length;r++)if(o=(n(u[r]).data("name")||"").toString(),f=n(u[r]).data("active"),e===f&&s.toUpperCase()<o.toUpperCase()){n(u[r]).before(i);break}else if(e&&!f){n(u[r]).before(i);break}else if(r===u.length-1){n(u[r]).after(i);break}};r.prototype.canTrimHistory=function(){return this.tab.data("trimmable")!==!1};r.prototype.setTrimmable=function(n){this.tab.data("trimmable",n)};r.prototype.trimHistory=function(n){var t=this.messages.find("li.message"),i=t.length;(n=n||f,!this.isLobby()&&this.canTrimHistory())&&(i<n||t.filter("li:eq("+(i-n)+")").prevAll().remove())};i.Room=r}(window.jQuery,window,window.chat),function(n,t,i,r,u,f,e,o){"use strict";function v(n){function t(){}t.exec=t;var i=new r.InlineLexer([],h);return i.rules.link=t,i.rules.url=t,i.output(n)}function l(n){return(n=n.toString(),n.length===1)?"0"+n:n}function p(){var n=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()}function w(t){return n("<div/>").html(t).text()}function b(t){return n("<div/>").text(t).html().replace(/\"/g,"&quot;")}function a(n){var t=arguments;return n.replace(/{(?:[0-9]+)}/g,function(n){return t[parseInt(n.substr(1,n.length-2),10)+1]})}function k(n){var t=Array.prototype.slice.call(arguments,0);return t[0]=o[n],a.apply(null,t)}function d(t,i,r,u,f){return i=i===null?[]:n.makeArray(i),r=r===null?[]:n.makeArray(r),u=u===null?[]:n.makeArray(u),f=f===null?[]:n.makeArray(f),n.map(t,function(n){var t=[];return i.indexOf(n)>-1&&t.push(s.getLanguageResource("Client_OnlineTag")),r.indexOf(n)>-1&&t.push(s.getLanguageResource("Client_AdminTag")),u.indexOf(n)>-1&&t.push(s.getLanguageResource("Client_OwnerTag")),f.indexOf(n)>-1&&t.push(s.getLanguageResource("Client_CreatorTag")),n+(t.length>0?" ("+t.join(", ")+")":"")})}function g(t,i,r){t=t||"";var u=t.indexOf("\n")!==-1;return u?n("<div />").append(i.multiline.tmpl({content:t})).html():(t=s.parseEmojis(t),t=v(t),t=s.transformEmojis(t),r&&(t=t.replace(/#([A-Za-z0-9-_]{1,30}\w*)/g,function(n){var t=n.substr(1);return r[t.toUpperCase()]?'<a href="#/rooms/'+t+'" title="'+t+'">'+n+"<\/a>":n})),f(t,{callback:function(n,t){return t?'<a rel="nofollow external" target="_blank" href="'+t+'" title="'+t+'">'+n+"<\/a>":n}}))}var h={highlight:function(n){return u.highlightAuto(n).value},tables:!1,breaks:!0,sanitize:!0,gfm:!0},c=navigator.userAgent||navigator.vendor||t.opera,y=/android.+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(c)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(c.substr(0,4)),s;n.fn.isNearTheEnd=function(){return typeof this[0]=="undefined"?!1:this[0].scrollTop+this.height()>=this[0].scrollHeight-10};n.fn.expandableContent=function(){return this.find("img:not(.gravatar)")};String.prototype.fromJsonDate=function(){return new Date(e(this.toString()).valueOf())};Date.prototype.formatDate=function(){var n=this.getMonth()+1,t=this.getDate(),i=this.getFullYear();return n+"/"+t+"/"+i};Date.prototype.formatTime=function(n){var i,t=this.getHours(),r,u;return i=t<12?"AM":"PM",t===0&&(t=12),t>12&&(t=t-12),r=l(this.getMinutes()),u=l(this.getSeconds()),t+":"+r+":"+u+(n?" "+i:"")};Date.prototype.toDate=function(){return new Date(this.getFullYear(),this.getMonth(),this.getDate())};Date.prototype.diffDays=function(n){var t=this.getTime(),i=n.getTime();return parseInt((t-i)/864e5,10)};Date.prototype.addDays=function(n){return new Date(this.getTime()+864e5*n)};s={trim:function(n,t){return n.length>t?n.substr(0,t-3)+"...":n},randomUniqueId:function(t){for(var i=Math.floor(Math.random()*100);n("#"+t+i.toString()).length>0;)i=Math.Floor(Math.random()*100);return t+i},markdownToHtml:function(n){var t=r.parse;return t(n,h)},isMobile:y,parseEmojis:function(n){var t=(new i.Parser).parse;return t(n)},transformEmojis:function(n){var t=(new i.Parser).transformToHtml;return t(n)},decodeHtml:w,encodeHtml:b,newId:p,processContent:g,format:a,getLanguageResource:k,tagUsers:d};t.chat||(t.chat={});t.chat.utility=s}(window.jQuery,window,window.Emoji,window.marked,window.hljs,window.linkify,window.moment,window.languageResources);window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(n){window.setTimeout(n,1e3/60)}}();main(),function(n,t){"use strict";var i=n("#notifications-container").data("mode"),r={multiline:n("#multiline-content-template")};n("#notifications-container").on("click",".js-mark-as-read",function(t){var i=n(this),r=i.data("actionUrl"),u=i.data("notificationId");if(t.preventDefault(),i.hasClass("disabled"))return!1;i.addClass("disabled");n.publish("notifications.mark",[{url:r,notificationId:u}])});n(".js-mark-all-as-read").on("click",function(t){var i=n(this),r=i.data("actionUrl");t.preventDefault();n.publish("notifications.markAll",[{url:r}])});n(".linkify").each(function(){var u=n(this),i=u.html();i=t.processContent(i,r,null);u.html(i)});n(".notification-item .time").each(function(){var t=n(this),i=t.data("timestamp").fromJsonDate();t.text(i.toLocaleString())});n.subscribe("notifications.mark",function(t,i){var r=n.ajax(i.url,{type:"POST",dataType:"json",data:{notificationId:i.notificationId}});r.done(function(){n.publish("notifications.read",[i.notificationId])});r.fail(function(){window.console&&window.console.log&&window.console.log("failed to mark notification as read","notification id: ",i.notificationId)})});n.subscribe("notifications.read",function(t,r){var u=n('li[data-notification-id="'+r+'"]'),f=u.find(".js-mark-as-read");i==="unread"?u.fadeOut("slow",function(){u.remove()}):(u.removeClass("notification-unread"),f.fadeOut("slow",function(){f.remove()}))});n.subscribe("notifications.markAll",function(t,i){var r=n.ajax(i.url,{type:"POST",dataType:"json"});r.done(function(){n.publish("notifications.readAll")});r.fail(function(){window.console&&window.console.log&&window.console.log("failed to mark ALL notifications as read")})});n.subscribe("notifications.readAll",function(){var t=n(".notification-unread"),r=t.find(".js-mark-as-read");i==="unread"?t.fadeOut("slow",function(){t.remove();n("#no-notifications").fadeIn("fast");n("#notifications-pager").fadeOut("fast")}):(t.removeClass("notification-unread"),r.fadeOut("slow",function(){r.remove()}))});n.subscribe("notifications.empty",function(){n(".js-mark-all-as-read").addClass("disabled")})}(window.jQuery,window.chat.utility),function(n){"use strict";function r(n){t=n;i.text(t);i.data("unread",t)}function u(){t===0&&n.publish("notifications.empty")}var i=n("#js-unread-counter"),t=i.data("unread");n.subscribe("notifications.read",function(){r(t-1);u()});n.subscribe("notifications.readAll",function(){r(0);u()})}(window.jQuery);